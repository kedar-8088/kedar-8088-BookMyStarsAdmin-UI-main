import{u as ve,j as e,a as l,d as y,ap as Ce,ax as V,ar as Ie,as as G,at as Se,au as we,n as T,am as Ae,an as Ee,t as De,U as H,V as Y,ay as J,az as A,Y as Ne,av as ke,ao as Te,T as g,c as Fe,f as Be,A as Pe,h as ze,D as We,X as p,aj as X,ak as _,r as $e,ad as Ue,ae as Me,af as Le,ag as F,ah as B,ai as Oe,aA as Re,aB as Ve,al as Ge}from"./mui-DJAgGlcD.js";import{r as d}from"./react-CeAUEJ0P.js";import{B as m,S as i,M as He,g as Ye}from"./index-BvpLlJd4.js";import{a as f}from"./vendor-BhB35ZXg.js";import{g as Je}from"./StateApi-BpDT1LEQ.js";import{b as Xe}from"./CountryApi-BRddreOc.js";import{d as _e,h as q}from"./Add-DIF5rR4-.js";const qe=async(o,c=0,r=10)=>await f({method:"get",url:`${m}/v1/city/list?pageNumber=${c}&pageSize=${r}`,headers:o}),Ke=async(o,c)=>{try{const r=await f({method:"POST",url:`${m}/v1/city/create`,headers:c,data:o});r.data.code===200?i.fire("Success",r.data.message,"success"):r.data.code===400&&i.fire("Error",r.data.error,"error")}catch(r){i.fire("Error",r.message,"error")}},Qe=async(o,c)=>await f({method:"delete",url:`${m}/v1/city/${o}`,headers:c}).then(r=>{r.data.code===200?i.fire("Deleted!",r.data.message,"success"):r.data.code===400&&i.fire("Error",r.data.error,"error")}).catch(r=>{i.fire("Error",r.message,"error")}),Ze=async(o,c)=>await f({method:"GET",url:`${m}/v1/city/${o}`,headers:c}),et=async(o,c)=>await f({method:"PUT",url:`${m}/v1/city/update/${o.cityId}`,headers:c,data:o}).then(r=>{r.data.code===200?i.fire("Success",r.data.message,"success"):r.data.code===400&&i.fire("Error",r.data.error,"error")}).catch(r=>{i.fire("Error",r.message,"error")}),tt=async(o,c)=>await f({method:"PUT",url:`${m}/v1/city/${o}/activate`,headers:c}).then(r=>{r.data.code===200?i.fire("Success",r.data.message,"success"):r.data.code===400&&i.fire("Error",r.data.error,"error")}).catch(r=>{i.fire("Error",r.message,"error")}),at=async(o,c)=>await f({method:"PUT",url:`${m}/v1/city/${o}/deactivate`,headers:c}).then(r=>{r.data.code===200?i.fire("Success",r.data.message,"success"):r.data.code===400&&i.fire("Error",r.data.error,"error")}).catch(r=>{i.fire("Error",r.message,"error")}),P=[{id:"cityId",label:"ID"},{id:"cityName",label:"City Name",minWidth:150},{id:"stateName",label:"State",minWidth:120},{id:"countryName",label:"Country",minWidth:120},{id:"isActive",label:"Status",align:"center"},{id:"insertedDate",label:"Created Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],dt=()=>{ve();const[o,c]=d.useState(0),[r,K]=d.useState(10),[j,z]=d.useState([]),[Q,b]=d.useState(!1),[E,W]=d.useState(!1),[$,Z]=d.useState("list"),[n,v]=d.useState({cityName:"",countryId:"",stateId:"",isActive:!0}),[h,U]=d.useState({}),[ee,S]=d.useState(!1),[te,ae]=d.useState(null),[M,L]=d.useState(0),[re,se]=d.useState([]),[ie,oe]=d.useState([]),[ne,D]=d.useState([]),ce=async()=>{try{const t=await Je(x);if(t.data.code===200){const a=t.data.data||[];se(a),D(a)}}catch(t){console.error("Error fetching states:",t)}},le=async()=>{try{const t=await Xe(x);t.data.code===200&&oe(t.data.data||[])}catch(t){console.error("Error fetching countries:",t)}},de=(t,a)=>{c(a)},he=t=>{K(+t.target.value),c(0)},xe=(t,a)=>{a!==null&&Z(a)},C=JSON.parse(sessionStorage.getItem("user")),x={"Content-Type":"application/json",Authorization:"Bearer "+(C==null?void 0:C.accessToken)},ue=async()=>{var t,a;try{if(!C||!C.accessToken){console.error("User not authenticated"),i.fire("Error","Please login to continue","error");return}const s=await qe(x,o,r),I=((t=s.data.data)==null?void 0:t.cities)||[],N=((a=s.data.data)==null?void 0:a.totalCount)||0;if(I&&Array.isArray(I)){const k=I.map(u=>({cityId:u.cityId,cityName:u.cityName,stateName:u.stateName||"N/A",countryName:u.countryName||"N/A",isActive:u.isActive?"Active":"Inactive",insertedDate:u.insertedDate?q(u.insertedDate).format("L"):"N/A",updatedDate:u.updatedDate?q(u.updatedDate).format("L"):"N/A"}));z(k),L(N)}else z([]),L(0)}catch(s){console.error("Error fetching data:",s)}};d.useEffect(()=>{ue(),ce(),le()},[ee,o,r]);const ye=async t=>{t.preventDefault();const a=ge();if(Object.keys(a).length>0)U(a);else try{if(E){const s={cityId:te,cityName:n.cityName,countryId:n.countryId,stateId:n.stateId,isActive:n.isActive};await et(s,x)}else{const s={...n,insertedDate:new Date().toISOString(),updatedDate:new Date().toISOString()};await Ke(s,x)}v({cityName:"",countryId:"",stateId:"",isActive:!0}),S(s=>!s),b(!1)}catch(s){console.error("Error saving city:",s)}},ge=()=>{const t={};return(!n.cityName||n.cityName.trim()==="")&&(t.cityName="Enter the city name"),(!n.countryId||n.countryId==="")&&(t.countryId="Select a country"),(!n.stateId||n.stateId==="")&&(t.stateId="Select a state"),t},w=t=>{const{name:a,value:s,checked:I}=t.target;if(a==="countryId")if(v({...n,countryId:s,stateId:""}),s){const N=re.filter(k=>k.countryId===parseInt(s));D(N)}else D([]);else v({...n,[a]:a==="isActive"?I:s});U({...h,[a]:null})},me=()=>{W(!1),v({cityName:"",countryId:"",stateId:"",isActive:!0}),b(!0)},O=async t=>{W(!0),b(!0);try{const a=await Ze(t,x),s=a.data.data||a.data;ae(s.cityId),v({cityName:s.cityName,countryId:s.countryId||"",stateId:s.stateId||"",isActive:s.isActive})}catch(a){console.error("Error fetching city details:",a)}},R=async t=>{i.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(async a=>{if(a.isConfirmed)try{await Qe(t,x),S(s=>!s),i.fire({title:"Deleted!",text:"City has been deleted.",icon:"success"})}catch(s){i.fire({title:"Error!",text:"There was a problem deleting the city.",icon:"error"}),console.error("Error deleting city:",s)}})},fe=async t=>{try{await tt(t,x),S(a=>!a)}catch(a){console.error("Error activating city:",a)}},je=async t=>{try{await at(t,x),S(a=>!a)}catch(a){console.error("Error deactivating city:",a)}},pe=()=>e.jsx(y,{container:!0,spacing:3,children:j.length===0?e.jsx(y,{item:!0,xs:12,children:e.jsxs(l,{sx:{textAlign:"center",py:4},children:[e.jsx(g,{variant:"h6",color:"textSecondary",children:"No cities found"}),e.jsxs(g,{variant:"body2",color:"textSecondary",children:["Cities array length: ",j.length]})]})}):j.map(t=>e.jsx(y,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(Fe,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #F48FB1 0%, #F8BBD9 100%)",color:"#880E4F",position:"relative",overflow:"hidden","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(0,0,0,0.15)",transition:"all 0.3s ease"}},children:[e.jsx(l,{sx:{position:"absolute",top:0,right:0,width:100,height:100,background:"rgba(255,255,255,0.3)",borderRadius:"50%",transform:"translate(30px, -30px)"}}),e.jsxs(Be,{sx:{flexGrow:1,position:"relative",zIndex:1},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Pe,{sx:{bgcolor:"rgba(136, 14, 79, 0.2)",mr:2,width:40,height:40,color:"#880E4F"},children:e.jsx(V,{})}),e.jsxs(l,{children:[e.jsx(g,{variant:"h6",sx:{fontWeight:"bold",mb:.5,color:"#880E4F"},children:t.cityName}),e.jsx(ze,{label:t.isActive,size:"small",sx:{bgcolor:t.isActive==="Active"?"rgba(76, 175, 80, 0.9)":"rgba(244, 67, 54, 0.9)",color:"white",fontWeight:"bold"}})]})]}),e.jsx(g,{variant:"body2",sx:{mb:2,opacity:.8,color:"#880E4F",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t.cityDescription}),e.jsx(We,{sx:{my:1,bgcolor:"rgba(136, 14, 79, 0.2)"}}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(g,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:["ID: ",t.cityId]}),e.jsx(g,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:t.insertedDate})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(g,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:["Updated: ",t.updatedDate]}),e.jsxs(l,{children:[e.jsx(p,{size:"small",onClick:()=>O(t.cityId),sx:{color:"#880E4F","&:hover":{bgcolor:"rgba(136, 14, 79, 0.1)"}},children:e.jsx(X,{fontSize:"small"})}),e.jsx(p,{size:"small",onClick:()=>R(t.cityId),sx:{color:"#880E4F","&:hover":{bgcolor:"rgba(136, 14, 79, 0.1)"}},children:e.jsx(_,{fontSize:"small"})})]})]})]})]})},t.cityId))}),be=()=>e.jsxs($e,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(Ue,{sx:{maxHeight:440},children:e.jsxs(Me,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(Le,{children:e.jsx(F,{children:P.map(t=>e.jsx(B,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx(Oe,{children:j.length===0?e.jsx(F,{children:e.jsx(B,{colSpan:P.length,align:"center",children:e.jsxs(l,{sx:{py:2},children:[e.jsx("div",{children:"No cities found"}),e.jsxs("div",{style:{fontSize:"12px",color:"gray"},children:["Cities array length: ",j.length]})]})})}):j.map(t=>e.jsx(F,{hover:!0,role:"checkbox",tabIndex:-1,children:P.map(a=>e.jsx(B,{align:a.align,children:a.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(p,{onClick:()=>O(t.cityId),style:{color:"#00afb5"},children:e.jsx(X,{})}),t.isActive==="Active"?e.jsx(p,{onClick:()=>je(t.cityId),style:{color:"#ff9800"},children:e.jsx(Re,{})}):e.jsx(p,{onClick:()=>fe(t.cityId),style:{color:"#4caf50"},children:e.jsx(Ve,{})}),e.jsx(p,{onClick:()=>R(t.cityId),color:"error",children:e.jsx(_,{})})]}):a.id==="isActive"?e.jsx(l,{sx:{backgroundColor:t[a.id]==="Active"?"#4caf50":"#f44336",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"bold"},children:t[a.id]}):t[a.id]},a.id))},t.cityId))})]})}),e.jsx(Ge,{rowsPerPageOptions:[10,25,100],component:"div",count:M,rowsPerPage:r,page:o,onPageChange:de,onRowsPerPageChange:he})]});return e.jsxs(l,{sx:{mt:4},children:[e.jsxs(He,{title:e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx("span",{children:"City Management"}),e.jsx(Ce,{badgeContent:M,color:"primary",children:e.jsx(V,{color:"action"})})]}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(Ie,{value:$,exclusive:!0,onChange:xe,size:"small",sx:{bgcolor:"background.paper"},children:[e.jsx(G,{value:"list","aria-label":"list view",children:e.jsx(Se,{})}),e.jsx(G,{value:"card","aria-label":"card view",children:e.jsx(we,{})})]}),e.jsxs(T,{variant:"contained",style:{backgroundColor:"#00afb5",color:"white"},sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:me,children:["Add City",e.jsx(_e,{sx:{color:"#fff"}})]})]})]}),children:[e.jsx(y,{container:!0,spacing:Ye}),$==="card"?pe():be()]}),e.jsxs(Ae,{open:Q,onClose:()=>b(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(Ee,{sx:{fontWeight:"bold",fontSize:"1.25rem",backgroundColor:"#f5f5f5"},children:E?"Edit City":"Add City"}),e.jsxs(l,{component:"form",onSubmit:ye,noValidate:!0,sx:{p:3},children:[e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(De,{fullWidth:!0,label:"City Name",name:"cityName",value:n.cityName,onChange:w,error:!!h.cityName,helperText:h.cityName})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(H,{fullWidth:!0,error:!!h.countryId,children:[e.jsx(Y,{children:"Country"}),e.jsxs(J,{name:"countryId",value:n.countryId,onChange:w,label:"Country",children:[e.jsx(A,{value:"",children:e.jsx("em",{children:"Select a country"})}),ie.map(t=>e.jsx(A,{value:t.countryId,children:t.countryName},t.countryId))]}),h.countryId&&e.jsx(l,{sx:{color:"error.main",fontSize:"0.75rem",mt:.5},children:h.countryId})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(H,{fullWidth:!0,error:!!h.stateId,children:[e.jsx(Y,{children:"State"}),e.jsxs(J,{name:"stateId",value:n.stateId,onChange:w,label:"State",disabled:!n.countryId,children:[e.jsx(A,{value:"",children:e.jsx("em",{children:"Select a state"})}),ne.map(t=>e.jsx(A,{value:t.stateId,children:t.stateName},t.stateId))]}),h.stateId&&e.jsx(l,{sx:{color:"error.main",fontSize:"0.75rem",mt:.5},children:h.stateId})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(Ne,{control:e.jsx(ke,{checked:n.isActive,onChange:w,name:"isActive",color:"primary"}),label:"Active Status"})})]}),e.jsxs(Te,{children:[e.jsx(T,{type:"submit",variant:"contained",style:{backgroundColor:"#00afb5",color:"white"},children:E?"Update":"Add"}),e.jsx(T,{onClick:()=>b(!1),style:{color:"#00afb5"},children:"Cancel"})]})]})]})]})};export{dt as default};
