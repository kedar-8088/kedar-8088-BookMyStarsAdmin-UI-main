import{u as ue,j as e,a as o,d as l,ap as ge,aC as M,ar as me,as as L,at as fe,au as pe,n as I,am as je,an as be,t as O,U as ye,V as Ce,ay as ve,az as R,Y as Se,av as Ie,ao as Ae,T as h,c as we,f as De,A as Ee,h as U,D as Ne,X as u,aj as V,ak as Y,r as ke,ad as Te,ae as Fe,af as Be,ag as A,ah as w,ai as We,aA as ze,aB as Pe,al as Me}from"./mui-DJAgGlcD.js";import{r as n}from"./react-CeAUEJ0P.js";import{M as Le,g as Oe,S as y}from"./index-BvpLlJd4.js";import{f as Re,u as Ue,a as Ve,b as Ye,d as He,c as Ge,e as Xe}from"./StateApi-BpDT1LEQ.js";import{b as Je}from"./CountryApi-BRddreOc.js";import{d as Ze,h as H}from"./Add-DIF5rR4-.js";import"./vendor-BhB35ZXg.js";const D=[{id:"stateId",label:"ID"},{id:"stateName",label:"State Name",minWidth:150},{id:"stateCode",label:"State Code",minWidth:120},{id:"countryName",label:"Country",minWidth:120},{id:"isActive",label:"Status",align:"center"},{id:"insertedDate",label:"Created Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],at=()=>{ue();const[C,E]=n.useState(0),[v,G]=n.useState(10),[x,N]=n.useState([]),[X,g]=n.useState(!1),[S,k]=n.useState(!1),[T,J]=n.useState("list"),[r,p]=n.useState({stateName:"",stateCode:"",countryId:"",isActive:!0}),[c,F]=n.useState({}),[Z,j]=n.useState(!1),[_,$]=n.useState(null),[B,W]=n.useState(0),[q,K]=n.useState([]),Q=(t,a)=>{E(a)},ee=t=>{G(+t.target.value),E(0)},te=(t,a)=>{a!==null&&J(a)},m=JSON.parse(sessionStorage.getItem("user")),d={"Content-Type":"application/json",Authorization:"Bearer "+(m==null?void 0:m.accessToken)},ae=async()=>{var t,a;try{if(!m||!m.accessToken){console.error("User not authenticated"),y.fire("Error","Please login to continue","error");return}const s=await Re(d,C,v),f=((t=s.data.data)==null?void 0:t.states)||[],he=((a=s.data.data)==null?void 0:a.totalCount)||0;if(f&&Array.isArray(f)){const xe=f.map(i=>({stateId:i.stateId,stateName:i.stateName,stateCode:i.stateCode,countryName:i.countryName||"N/A",isActive:i.isActive?"Active":"Inactive",insertedDate:i.insertedDate?H(i.insertedDate).format("L"):"N/A",updatedDate:i.updatedDate?H(i.updatedDate).format("L"):"N/A"}));N(xe),W(he)}else N([]),W(0)}catch(s){console.error("Error fetching data:",s)}},se=async()=>{try{const t=await Je(d);t.data.code===200&&K(t.data.data||[])}catch(t){console.error("Error fetching countries:",t)}};n.useEffect(()=>{ae(),se()},[Z,C,v]);const re=async t=>{t.preventDefault();const a=oe();if(Object.keys(a).length>0)F(a);else try{if(S){const s={stateId:_,stateName:r.stateName,stateCode:r.stateCode,countryId:r.countryId,isActive:r.isActive};await Ue(s,d)}else{const s={...r,insertedDate:new Date().toISOString(),updatedDate:new Date().toISOString()};await Ve(s,d)}p({stateName:"",stateCode:"",countryId:"",isActive:!0}),j(s=>!s),g(!1)}catch(s){console.error("Error saving state:",s)}},oe=()=>{const t={};return(!r.stateName||r.stateName.trim()==="")&&(t.stateName="Enter the state name"),(!r.stateCode||r.stateCode.trim()==="")&&(t.stateCode="Enter the state code"),(!r.countryId||r.countryId==="")&&(t.countryId="Select a country"),r.stateCode&&!/^[A-Z]{2,3}$/.test(r.stateCode.toUpperCase())&&(t.stateCode="State code must be 2-3 uppercase letters"),t},b=t=>{const{name:a,value:s,checked:f}=t.target;p({...r,[a]:a==="isActive"?f:s}),F({...c,[a]:null})},ne=()=>{k(!1),p({stateName:"",stateCode:"",countryId:"",isActive:!0}),g(!0)},z=async t=>{k(!0),g(!0);try{const a=await Ye(t,d),s=a.data.data||a.data;$(s.stateId),p({stateName:s.stateName,stateCode:s.stateCode,countryId:s.countryId||"",isActive:s.isActive})}catch(a){console.error("Error fetching state details:",a)}},P=async t=>{y.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(async a=>{if(a.isConfirmed)try{await He(t,d),j(s=>!s),y.fire({title:"Deleted!",text:"State has been deleted.",icon:"success"})}catch(s){y.fire({title:"Error!",text:"There was a problem deleting the state.",icon:"error"}),console.error("Error deleting state:",s)}})},ie=async t=>{try{await Xe(t,d),j(a=>!a)}catch(a){console.error("Error activating state:",a)}},le=async t=>{try{await Ge(t,d),j(a=>!a)}catch(a){console.error("Error deactivating state:",a)}},ce=()=>e.jsx(l,{container:!0,spacing:3,children:x.length===0?e.jsx(l,{item:!0,xs:12,children:e.jsxs(o,{sx:{textAlign:"center",py:4},children:[e.jsx(h,{variant:"h6",color:"textSecondary",children:"No states found"}),e.jsxs(h,{variant:"body2",color:"textSecondary",children:["States array length: ",x.length]})]})}):x.map(t=>e.jsx(l,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(we,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #F48FB1 0%, #F8BBD9 100%)",color:"#880E4F",position:"relative",overflow:"hidden","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(0,0,0,0.15)",transition:"all 0.3s ease"}},children:[e.jsx(o,{sx:{position:"absolute",top:0,right:0,width:100,height:100,background:"rgba(255,255,255,0.3)",borderRadius:"50%",transform:"translate(30px, -30px)"}}),e.jsxs(De,{sx:{flexGrow:1,position:"relative",zIndex:1},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Ee,{sx:{bgcolor:"rgba(136, 14, 79, 0.2)",mr:2,width:40,height:40,color:"#880E4F"},children:e.jsx(M,{})}),e.jsxs(o,{children:[e.jsx(h,{variant:"h6",sx:{fontWeight:"bold",mb:.5,color:"#880E4F"},children:t.stateName}),e.jsxs(o,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(U,{label:t.stateCode,size:"small",sx:{bgcolor:"rgba(136, 14, 79, 0.2)",color:"#880E4F",fontWeight:"bold",fontSize:"0.7rem"}}),e.jsx(U,{label:t.isActive,size:"small",sx:{bgcolor:t.isActive==="Active"?"rgba(76, 175, 80, 0.9)":"rgba(244, 67, 54, 0.9)",color:"white",fontWeight:"bold"}})]})]})]}),e.jsx(h,{variant:"body2",sx:{mb:2,opacity:.8,color:"#880E4F",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t.stateDescription}),e.jsx(Ne,{sx:{my:1,bgcolor:"rgba(136, 14, 79, 0.2)"}}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(h,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:["ID: ",t.stateId]}),e.jsx(h,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:t.insertedDate})]}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(h,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:["Updated: ",t.updatedDate]}),e.jsxs(o,{children:[e.jsx(u,{size:"small",onClick:()=>z(t.stateId),sx:{color:"#880E4F","&:hover":{bgcolor:"rgba(136, 14, 79, 0.1)"}},children:e.jsx(V,{fontSize:"small"})}),e.jsx(u,{size:"small",onClick:()=>P(t.stateId),sx:{color:"#880E4F","&:hover":{bgcolor:"rgba(136, 14, 79, 0.1)"}},children:e.jsx(Y,{fontSize:"small"})})]})]})]})]})},t.stateId))}),de=()=>e.jsxs(ke,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(Te,{sx:{maxHeight:440},children:e.jsxs(Fe,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(Be,{children:e.jsx(A,{children:D.map(t=>e.jsx(w,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx(We,{children:x.length===0?e.jsx(A,{children:e.jsx(w,{colSpan:D.length,align:"center",children:e.jsxs(o,{sx:{py:2},children:[e.jsx("div",{children:"No states found"}),e.jsxs("div",{style:{fontSize:"12px",color:"gray"},children:["States array length: ",x.length]})]})})}):x.map(t=>e.jsx(A,{hover:!0,role:"checkbox",tabIndex:-1,children:D.map(a=>e.jsx(w,{align:a.align,children:a.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(u,{onClick:()=>z(t.stateId),style:{color:"#00afb5"},children:e.jsx(V,{})}),t.isActive==="Active"?e.jsx(u,{onClick:()=>le(t.stateId),style:{color:"#ff9800"},children:e.jsx(ze,{})}):e.jsx(u,{onClick:()=>ie(t.stateId),style:{color:"#4caf50"},children:e.jsx(Pe,{})}),e.jsx(u,{onClick:()=>P(t.stateId),color:"error",children:e.jsx(Y,{})})]}):a.id==="isActive"?e.jsx(o,{sx:{backgroundColor:t[a.id]==="Active"?"#4caf50":"#f44336",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"bold"},children:t[a.id]}):t[a.id]},a.id))},t.stateId))})]})}),e.jsx(Me,{rowsPerPageOptions:[10,25,100],component:"div",count:B,rowsPerPage:v,page:C,onPageChange:Q,onRowsPerPageChange:ee})]});return e.jsxs(o,{sx:{mt:4},children:[e.jsxs(Le,{title:e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx("span",{children:"State Management"}),e.jsx(ge,{badgeContent:B,color:"primary",children:e.jsx(M,{color:"action"})})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(me,{value:T,exclusive:!0,onChange:te,size:"small",sx:{bgcolor:"background.paper"},children:[e.jsx(L,{value:"list","aria-label":"list view",children:e.jsx(fe,{})}),e.jsx(L,{value:"card","aria-label":"card view",children:e.jsx(pe,{})})]}),e.jsxs(I,{variant:"contained",style:{backgroundColor:"#00afb5",color:"white"},sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:ne,children:["Add State",e.jsx(Ze,{sx:{color:"#fff"}})]})]})]}),children:[e.jsx(l,{container:!0,spacing:Oe}),T==="card"?ce():de()]}),e.jsxs(je,{open:X,onClose:()=>g(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(be,{sx:{fontWeight:"bold",fontSize:"1.25rem",backgroundColor:"#f5f5f5"},children:S?"Edit State":"Add State"}),e.jsxs(o,{component:"form",onSubmit:re,noValidate:!0,sx:{p:3},children:[e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(O,{fullWidth:!0,label:"State Name",name:"stateName",value:r.stateName,onChange:b,error:!!c.stateName,helperText:c.stateName})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(O,{fullWidth:!0,label:"State Code",name:"stateCode",value:r.stateCode,onChange:b,error:!!c.stateCode,helperText:c.stateCode,placeholder:"e.g., CA, NY, TX",inputProps:{style:{textTransform:"uppercase"}}})}),e.jsx(l,{item:!0,xs:12,children:e.jsxs(ye,{fullWidth:!0,error:!!c.countryId,children:[e.jsx(Ce,{children:"Country"}),e.jsxs(ve,{name:"countryId",value:r.countryId,onChange:b,label:"Country",children:[e.jsx(R,{value:"",children:e.jsx("em",{children:"Select a country"})}),q.map(t=>e.jsx(R,{value:t.countryId,children:t.countryName},t.countryId))]}),c.countryId&&e.jsx(o,{sx:{color:"error.main",fontSize:"0.75rem",mt:.5},children:c.countryId})]})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(Se,{control:e.jsx(Ie,{checked:r.isActive,onChange:b,name:"isActive",color:"primary"}),label:"Active Status"})})]}),e.jsxs(Ae,{children:[e.jsx(I,{type:"submit",variant:"contained",style:{backgroundColor:"#00afb5",color:"white"},children:S?"Update":"Add"}),e.jsx(I,{onClick:()=>g(!1),style:{color:"#00afb5"},children:"Cancel"})]})]})]})]})};export{at as default};
