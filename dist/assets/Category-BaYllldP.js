import{u as pe,q as ee,j as e,a as y,T as D,ap as be,aq as te,ar as ve,as as ae,at as we,au as Ce,n as O,am as De,an as je,d as E,t as re,Y as Ae,av as Ee,ao as Se,c as Ie,f as Ne,A as ke,h as Fe,D as Te,X as M,aj as se,ak as oe,r as Pe,ad as ze,ae as We,af as Me,ag as V,ah as q,ai as Re,al as Ue}from"./mui-BHd6aP3D.js";import{r as f}from"./react-CeAUEJ0P.js";import{B as I,M as $e,S as C}from"./index-CqEkO1RD.js";import{a as P}from"./vendor-BhB35ZXg.js";import{d as Le,h as ie}from"./Add-Hd0l8K7I.js";const Oe=async(g,c=0,v=10)=>{var x,r;try{if(!g||!g.Authorization)throw console.error("Category fetch - Missing or invalid headers:",g),new Error("Authentication headers are required");const t=Math.max(0,parseInt(c)||0),l=Math.max(1,parseInt(v)||10);console.log("Fetch Categories Request:",{url:`${I}/bookmystarsadmin/category/v1/list`,pageNumber:t,pageSize:l,hasAuth:!!g.Authorization});const o=await P({method:"get",url:`${I}/bookmystarsadmin/category/v1/list?pageNumber=${t}&pageSize=${l}`,headers:g});return console.log("Category fetch response:",o==null?void 0:o.data),o}catch(t){throw console.error("Error fetching categories:",t),console.error("Error response:",(x=t==null?void 0:t.response)==null?void 0:x.data),console.error("Error status:",(r=t==null?void 0:t.response)==null?void 0:r.status),t}},Ve=async(g,c)=>{var v,x;try{console.log("Adding category with data:",g);const r={categoryName:g.categoryName,categoryDescription:g.categoryDescription,isActive:!!g.isActive,isDelete:!!g.isDelete,createdBy:g.createdBy||g.insertedBy};console.log("Formatted category request data:",r);const t=await P({method:"POST",url:`${I}/bookmystarsadmin/category/v1/create`,headers:c,data:r});console.log("Add category response:",t.data);const l=t==null?void 0:t.data,o=l==null?void 0:l.code,p=l==null?void 0:l.status,j=(l==null?void 0:l.message)||"Category created successfully",A=(l==null?void 0:l.error)||"An error occurred";if(o===201||o===200||p==="SUCCESS"||t.status===201||t.status===200)return{success:!0,message:j};if(o===400||t.status===400)throw new Error(A||"Failed to create category");if(t.status>=200&&t.status<300)return{success:!0,message:j};throw new Error(j||"Failed to create category")}catch(r){console.error("Error adding category:",r);const t=((x=(v=r==null?void 0:r.response)==null?void 0:v.data)==null?void 0:x.message)||(r==null?void 0:r.message)||"Failed to add category";throw new Error(t)}},qe=async(g,c)=>{var v,x;try{console.log("Deleting category with ID:",g);const r=await P({method:"DELETE",url:`${I}/bookmystarsadmin/category/v1/${g}`,headers:c});console.log("Delete category response:",r.data);const t=r==null?void 0:r.data,l=t==null?void 0:t.code,o=t==null?void 0:t.status,p=(t==null?void 0:t.message)||"Category deleted successfully",j=(t==null?void 0:t.error)||"An error occurred";if(l===200||o==="SUCCESS"||r.status===200)return{success:!0,message:p};if(l===400||r.status===400)throw new Error(j||"Failed to delete category");if(r.status>=200&&r.status<300)return{success:!0,message:p};throw new Error(p||"Failed to delete category")}catch(r){console.error("Error deleting category:",r);const t=((x=(v=r==null?void 0:r.response)==null?void 0:v.data)==null?void 0:x.message)||(r==null?void 0:r.message)||"Failed to delete category";throw new Error(t)}},Ge=async(g,c)=>await P({method:"GET",url:`${I}/bookmystarsadmin/category/v1/${g}`,headers:c}),He=async(g,c)=>{var v,x;try{console.log("Updating category with data:",g);const r=g.categoryId,t={categoryName:g.categoryName,categoryDescription:g.categoryDescription,isActive:g.isActive,isDelete:g.isDelete||!1},l=await P({method:"PUT",url:`${I}/bookmystarsadmin/category/v1/update/${r}`,headers:c,data:t});console.log("Update category response:",l.data);const o=l==null?void 0:l.data,p=o==null?void 0:o.code,j=o==null?void 0:o.status,A=(o==null?void 0:o.message)||"Category updated successfully",N=(o==null?void 0:o.error)||"An error occurred";if(p===201||p===200||j==="SUCCESS"||l.status===201||l.status===200)return{success:!0,message:A,data:o==null?void 0:o.data};if(p===400||l.status===400)throw new Error(N||"Failed to update category");if(l.status>=200&&l.status<300)return{success:!0,message:A,data:o==null?void 0:o.data};throw new Error(A||"Failed to update category")}catch(r){console.error("Error updating category:",r);let t="Failed to update category";throw(x=(v=r==null?void 0:r.response)==null?void 0:v.data)!=null&&x.message?t=r.response.data.message:r!=null&&r.message&&(t=r.message),new Error(t)}},G=[{id:"categoryId",label:"ID"},{id:"categoryName",label:"Category Name",minWidth:150},{id:"categoryDescription",label:"Description",minWidth:200},{id:"isActive",label:"Status",align:"center"},{id:"insertedDate",label:"Created Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],Qe=()=>{const g=pe(),c=ee(g.breakpoints.down("sm")),v=ee(g.breakpoints.down("md")),[x,r]=f.useState(0),[t,l]=f.useState(10),[o,p]=f.useState([]),[j,A]=f.useState([]),[N,S]=f.useState(!1),[z,R]=f.useState(!1),[H,ne]=f.useState("list"),[m,k]=f.useState({categoryName:"",categoryDescription:"",isActive:!0}),[F,W]=f.useState({}),[ce,Y]=f.useState(!1),[B,X]=f.useState(null),[_,U]=f.useState(0),le=(i,a)=>{r(a)},de=i=>{l(+i.target.value),r(0)},ge=(i,a)=>{a!==null&&ne(a)},h=JSON.parse(sessionStorage.getItem("user")),T={"Content-Type":"application/json",Authorization:"Bearer "+(h==null?void 0:h.accessToken)},ue=async()=>{var i;try{if(!h||!h.accessToken){console.error("User not authenticated"),C.fire("Error","Please login to continue","error");return}const a=await Oe(T,x,t);console.log("=== CATEGORY FETCH DEBUG ==="),console.log("Full API response:",a),console.log("Response data:",a.data);const s=((i=a==null?void 0:a.data)==null?void 0:i.body)??(a==null?void 0:a.data),n=s==null?void 0:s.data;console.log("Response body:",s),console.log("Data node:",n);let u=[],b=0;if(n?Array.isArray(n)?(u=n,b=n.length):n.content&&Array.isArray(n.content)?(u=n.content,b=n.totalElements||n.totalCount||n.content.length):n.categories&&Array.isArray(n.categories)?(u=n.categories,b=n.totalElements||n.totalCount||n.categories.length):Array.isArray(n)&&(u=n,b=n.length):Array.isArray(s)&&(u=s,b=s.length),u&&Array.isArray(u)){console.log("Fetched data:",u),console.log("Total count from API:",b),A(u);const w=u.map(d=>{const Z=d.isActive!==null&&d.isActive!==void 0?d.isActive:d.active!==null&&d.active!==void 0?d.active:!0;console.log(`Category ${d.categoryName} - isActive field: ${d.isActive}, active field: ${d.active}, final value: ${Z}`);const L={categoryId:d.categoryId,categoryName:d.categoryName||"N/A",categoryDescription:d.categoryDescription||"N/A",isActive:!!Z,insertedDate:d.insertedDate?ie(d.insertedDate).format("L"):"N/A",updatedDate:d.updatedDate?ie(d.updatedDate).format("L"):"N/A"};return console.log(`Category ${d.categoryName} dates:`,{originalInsertedDate:d.insertedDate,originalUpdatedDate:d.updatedDate,formattedInsertedDate:L.insertedDate,formattedUpdatedDate:L.updatedDate}),L});console.log("Processed table data:",w),p(w),U(typeof b=="number"?b:0)}else console.warn("No valid data found in response"),p([]),U(0)}catch(a){console.error("Error fetching data:",a),C.fire("Error","Failed to load categories. Please try again.","error"),p([]),U(0)}};f.useEffect(()=>{ue()},[ce,x,t]),f.useEffect(()=>{if(N)try{document.activeElement&&document.activeElement.blur()}catch{}},[N]);const he=async i=>{var s,n,u,b;i.preventDefault();const a=me();if(Object.keys(a).length>0)W(a);else try{if(z){const w={categoryId:B,categoryName:((s=m.categoryName)==null?void 0:s.trim())||"",categoryDescription:((n=m.categoryDescription)==null?void 0:n.trim())||"",isActive:!!m.isActive,isDelete:!1,updatedBy:h!=null&&h.userId?{userId:h.userId,userName:h.userName||h.username||"admin"}:{userId:1,userName:"admin"}};console.log("Update Data Debug:",{updatedData:w,categoryId:B,editMode:z,userdata:m});const d=await He(w,T);if(d.success)console.log("Category updated successfully:",d.message),console.log("Update result data:",d.data),C.fire("Success",d.message,"success");else throw new Error(d.message||"Update operation failed")}else{const w={categoryName:((u=m.categoryName)==null?void 0:u.trim())||"",categoryDescription:((b=m.categoryDescription)==null?void 0:b.trim())||"",isActive:!!m.isActive,isDelete:!1,createdBy:h!=null&&h.userId?{userId:parseInt(h.userId,10),userName:h.userName||h.username||"admin"}:{userId:1,userName:"admin"}};console.log("Add Data Debug:",{newData:w,userdata:m});const d=await Ve(w,T);if(d.success)console.log("Category added successfully:",d.message),C.fire("Success",d.message,"success");else throw new Error(d.message||"Add operation failed")}k({categoryName:"",categoryDescription:"",isActive:!0}),console.log("Triggering data refresh after update..."),Y(w=>!w),S(!1)}catch(w){console.error("Error saving category:",w),C.fire("Error","Failed to save category. Please try again.","error")}},me=()=>{const i={};return(!m.categoryName||m.categoryName.trim()==="")&&(i.categoryName="Enter the category name"),(!m.categoryDescription||m.categoryDescription.trim()==="")&&(i.categoryDescription="Enter the description"),i},$=i=>{const{name:a,value:s,checked:n}=i.target;k({...m,[a]:a==="isActive"?n:s}),W({...F,[a]:null})},xe=()=>{R(!1),k({categoryName:"",categoryDescription:"",isActive:!0}),W({}),S(!0)},J=()=>{S(!1),R(!1),k({categoryName:"",categoryDescription:"",isActive:!0}),W({}),X(null)},Q=async i=>{var a;R(!0),S(!0);try{const s=await Ge(i,T),n=((a=s==null?void 0:s.data)==null?void 0:a.body)??(s==null?void 0:s.data),u=(n==null?void 0:n.data)||n;if(u&&u.categoryId){console.log("Category details for edit:",u);const b=u.isActive!==null&&u.isActive!==void 0?u.isActive:u.active!==null&&u.active!==void 0?u.active:!0;X(u.categoryId),k({categoryName:u.categoryName||"",categoryDescription:u.categoryDescription||"",isActive:!!b})}else C.fire("Error","Failed to load category details","error"),S(!1)}catch(s){console.error("Error fetching category details:",s),C.fire("Error","Failed to load category details. Please try again.","error"),S(!1)}},K=async i=>{C.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(async a=>{if(a.isConfirmed)try{console.log("Deleting category with ID:",i);const s=await qe(i,T);if(s.success)console.log("Category deleted successfully:",s.message),Y(n=>!n),C.fire({title:"Deleted!",text:s.message||"Category has been deleted successfully.",icon:"success"});else throw new Error(s.message||"Delete operation failed")}catch(s){console.error("Error deleting category:",s),C.fire({title:"Error!",text:s.message||"There was a problem deleting the category.",icon:"error"})}})},ye=()=>e.jsx(E,{container:!0,spacing:c?2:3,children:o.length===0?e.jsx(E,{item:!0,xs:12,children:e.jsxs(y,{sx:{textAlign:"center",py:4},children:[e.jsx(D,{variant:"h6",color:"textSecondary",children:"No categories found"}),e.jsxs(D,{variant:"body2",color:"textSecondary",children:["Categories array length: ",o.length]})]})}):o.map(i=>e.jsx(E,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(Ie,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #F48FB1 0%, #F8BBD9 100%)",color:"#880E4F",position:"relative",overflow:"hidden","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(0,0,0,0.15)",transition:"all 0.3s ease"}},children:[e.jsx(y,{sx:{position:"absolute",top:0,right:0,width:100,height:100,background:"rgba(255,255,255,0.3)",borderRadius:"50%",transform:"translate(30px, -30px)"}}),e.jsxs(Ne,{sx:{flexGrow:1,position:"relative",zIndex:1},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(ke,{sx:{bgcolor:"rgba(136, 14, 79, 0.2)",mr:2,width:40,height:40,color:"#880E4F"},children:e.jsx(te,{})}),e.jsxs(y,{children:[e.jsx(D,{variant:"h6",sx:{fontWeight:"bold",mb:.5,color:"#880E4F"},children:i.categoryName}),e.jsx(Fe,{label:i.isActive?"Active":"Inactive",size:"small",sx:{bgcolor:i.isActive?"rgba(76, 175, 80, 0.9)":"rgba(244, 67, 54, 0.9)",color:"white",fontWeight:"bold"}})]})]}),e.jsx(D,{variant:"body2",sx:{mb:2,opacity:.8,color:"#880E4F",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:i.categoryDescription}),e.jsx(Te,{sx:{my:1,bgcolor:"rgba(136, 14, 79, 0.2)"}}),e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(D,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:["ID: ",i.categoryId]}),e.jsx(D,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:i.insertedDate})]}),e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(D,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:["Updated: ",i.updatedDate]}),e.jsxs(y,{children:[e.jsx(M,{size:"small",onClick:()=>Q(i.categoryId),sx:{color:"#880E4F","&:hover":{bgcolor:"rgba(136, 14, 79, 0.1)"}},children:e.jsx(se,{fontSize:"small"})}),e.jsx(M,{size:"small",onClick:()=>K(i.categoryId),sx:{color:"#880E4F","&:hover":{bgcolor:"rgba(136, 14, 79, 0.1)"}},children:e.jsx(oe,{fontSize:"small"})})]})]})]})]})},i.categoryId))}),fe=()=>{const i=c?G.filter(a=>["categoryId","categoryName","actions"].includes(a.id)):v?G.filter(a=>!["insertedDate","updatedDate","categoryDescription"].includes(a.id)):G;return e.jsxs(Pe,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(ze,{sx:{maxHeight:440,overflowX:"auto","&::-webkit-scrollbar":{height:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"#f1f1f1"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#888",borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:"#555"}},children:e.jsxs(We,{stickyHeader:!0,"aria-label":"sticky table",sx:{minWidth:c?600:"100%"},children:[e.jsx(Me,{children:e.jsx(V,{children:i.map(a=>e.jsx(q,{align:a.align,sx:{minWidth:c?a.minWidth?Math.min(a.minWidth,100):"auto":a.minWidth,fontWeight:600,fontSize:c?13:15,whiteSpace:"nowrap",...a.id==="actions"&&{textAlign:"right"}},children:a.label},a.id))})}),e.jsx(Re,{children:o.length===0?e.jsx(V,{children:e.jsx(q,{colSpan:i.length,align:"center",children:e.jsx(y,{sx:{py:2},children:e.jsx("div",{children:"No categories found"})})})}):o.map(a=>e.jsx(V,{hover:!0,role:"checkbox",tabIndex:-1,children:i.map(s=>e.jsx(q,{align:s.align,sx:{fontSize:c?12:14,whiteSpace:"nowrap",...s.id==="actions"&&{textAlign:"right"}},children:s.id==="isActive"?e.jsx(y,{sx:{backgroundColor:a.isActive?"#4caf50":"#f44336",color:"white",padding:c?"2px 6px":"4px 8px",borderRadius:"4px",fontSize:c?"10px":"12px",fontWeight:"bold",textAlign:"center",display:"inline-block",minWidth:c?60:80},children:a.isActive?"Active":"Inactive"}):s.id==="actions"?e.jsxs(y,{sx:{display:"flex",gap:.5,flexWrap:"wrap",justifyContent:"flex-end"},children:[e.jsx(M,{size:c?"small":"medium",onClick:()=>Q(a.categoryId),style:{color:"#00afb5"},children:e.jsx(se,{fontSize:c?"small":"medium"})}),e.jsx(M,{size:c?"small":"medium",onClick:()=>K(a.categoryId),color:"error",children:e.jsx(oe,{fontSize:c?"small":"medium"})})]}):e.jsx(D,{variant:"body2",sx:{fontSize:c?12:14,overflow:"hidden",textOverflow:"ellipsis",maxWidth:c?150:"none"},children:a[s.id]})},s.id))},a.categoryId))})]})}),e.jsx(Ue,{rowsPerPageOptions:c?[10,25]:[10,25,100],component:"div",count:_,rowsPerPage:t,page:x,onPageChange:le,onRowsPerPageChange:de,sx:{overflowX:"auto","& .MuiTablePagination-toolbar":{flexWrap:"wrap",gap:1},"& .MuiTablePagination-selectLabel":{fontSize:c?12:14},"& .MuiTablePagination-displayedRows":{fontSize:c?12:14}}})]})};return e.jsxs(y,{sx:{mt:4,px:{xs:1,sm:2}},children:[e.jsx($e,{title:e.jsxs(y,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},gap:2,width:"100%"},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsx(D,{variant:"h4",sx:{fontSize:{xs:"1.2rem",sm:"1.5rem"}},children:"Category Management"}),e.jsx(be,{badgeContent:_,color:"primary",children:e.jsx(te,{color:"action"})})]}),e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",width:{xs:"100%",sm:"auto"},justifyContent:{xs:"flex-start",sm:"flex-end"}},children:[e.jsxs(ve,{value:H,exclusive:!0,onChange:ge,size:"small",children:[e.jsx(ae,{value:"list","aria-label":"list view",children:e.jsx(we,{})}),e.jsx(ae,{value:"card","aria-label":"card view",children:e.jsx(Ce,{})})]}),e.jsxs(O,{variant:"contained",style:{backgroundColor:"#00afb5",color:"white"},sx:{display:"flex",alignItems:"center",fontSize:{xs:"13px",sm:"15px"},whiteSpace:"nowrap",width:{xs:"100%",sm:"auto"}},onClick:xe,children:[c?"Add":"Add Category",e.jsx(Le,{sx:{color:"#fff",ml:.5}})]})]})]}),children:H==="card"?ye():fe()}),e.jsxs(De,{open:N,onClose:J,fullWidth:!0,maxWidth:c?"xs":"md",fullScreen:c,children:[e.jsx(je,{sx:{fontWeight:"bold",fontSize:"1.25rem",backgroundColor:"#f5f5f5"},children:z?"Edit Category":"Add Category"}),e.jsxs(y,{component:"form",onSubmit:he,noValidate:!0,sx:{p:{xs:2,sm:3}},children:[e.jsxs(E,{container:!0,spacing:2,children:[e.jsx(E,{item:!0,xs:12,children:e.jsx(re,{fullWidth:!0,label:"Category Name",name:"categoryName",value:m.categoryName,onChange:$,error:!!F.categoryName,helperText:F.categoryName})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(re,{fullWidth:!0,label:"Description",name:"categoryDescription",value:m.categoryDescription,onChange:$,error:!!F.categoryDescription,helperText:F.categoryDescription,multiline:!0,rows:3})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(Ae,{control:e.jsx(Ee,{checked:m.isActive,onChange:$,name:"isActive",color:"primary"}),label:"Active Status"})})]}),e.jsxs(Se,{children:[e.jsx(O,{type:"submit",variant:"contained",style:{backgroundColor:"#00afb5",color:"white"},children:z?"Update":"Add"}),e.jsx(O,{onClick:J,style:{color:"#00afb5"},children:"Cancel"})]})]})]})]})};export{Qe as default};
