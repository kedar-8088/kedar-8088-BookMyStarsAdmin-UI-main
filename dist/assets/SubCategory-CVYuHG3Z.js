import{u as ye,j as e,a as o,d as x,ap as fe,aq as G,ar as me,as as H,at as pe,au as Ce,n as N,am as je,an as ve,t as Y,U as Se,V as De,ay as Ie,az as T,Y as we,av as Ae,ao as Ee,T as f,c as ke,f as Ne,A as Te,h as q,D as Fe,X as j,aj as J,ak as X,r as Pe,ad as ze,ae as Be,af as We,ag as F,ah as P,ai as $e,aA as Me,aB as Re,al as Ue}from"./mui-DJAgGlcD.js";import{r as g}from"./react-CeAUEJ0P.js";import{B as m,S as i,M as Oe,g as Le}from"./index-BvpLlJd4.js";import{a as p}from"./vendor-BhB35ZXg.js";import{f as Ve,b as Ge}from"./CategoryApi--Z50CI8D.js";import{d as He,h as _}from"./Add-DIF5rR4-.js";const Ye=async(n,l=0,r=10)=>await p({method:"get",url:`${m}/v1/subcategory/list?pageNumber=${l}&pageSize=${r}`,headers:n}),qe=async(n,l)=>{try{const r=await p({method:"POST",url:`${m}/v1/subcategory/create`,headers:l,data:n});r.data.code===200?i.fire("Success",r.data.message,"success"):r.data.code===400&&i.fire("Error",r.data.error,"error")}catch(r){i.fire("Error",r.message,"error")}},Je=async(n,l)=>await p({method:"delete",url:`${m}/v1/subcategory/${n}`,headers:l}).then(r=>{r.data.code===200?i.fire("Deleted!",r.data.message,"success"):r.data.code===400&&i.fire("Error",r.data.error,"error")}).catch(r=>{i.fire("Error",r.message,"error")}),Xe=async(n,l)=>await p({method:"GET",url:`${m}/v1/subcategory/${n}`,headers:l}),_e=async(n,l)=>await p({method:"PUT",url:`${m}/v1/subcategory/update/${n.subCategoryId}`,headers:l,data:n}).then(r=>{r.data.code===200?i.fire("Success",r.data.message,"success"):r.data.code===400&&i.fire("Error",r.data.error,"error")}).catch(r=>{i.fire("Error",r.message,"error")}),Ke=async(n,l)=>await p({method:"PUT",url:`${m}/v1/subcategory/${n}/activate`,headers:l}).then(r=>{r.data.code===200?i.fire("Success",r.data.message,"success"):r.data.code===400&&i.fire("Error",r.data.error,"error")}).catch(r=>{i.fire("Error",r.message,"error")}),Qe=async(n,l)=>await p({method:"PUT",url:`${m}/v1/subcategory/${n}/deactivate`,headers:l}).then(r=>{r.data.code===200?i.fire("Success",r.data.message,"success"):r.data.code===400&&i.fire("Error",r.data.error,"error")}).catch(r=>{i.fire("Error",r.message,"error")}),z=[{id:"subCategoryId",label:"ID"},{id:"subCategoryName",label:"Sub-Category Name",minWidth:150},{id:"subCategoryDescription",label:"Description",minWidth:200},{id:"isActive",label:"Status",align:"center"},{id:"insertedDate",label:"Created Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],ot=()=>{ye();const[n,l]=g.useState(0),[r,K]=g.useState(10),[C,B]=g.useState([]),[I,y]=g.useState([]),[Q,v]=g.useState(!1),[k,W]=g.useState(!1),[$,Z]=g.useState("list"),[d,w]=g.useState({subCategoryName:"",subCategoryDescription:"",categoryId:"",isActive:!0}),[b,M]=g.useState({}),[ee,A]=g.useState(!1),[te,ae]=g.useState(null),[R,U]=g.useState(0),re=(t,a)=>{l(a)},se=t=>{K(+t.target.value),l(0)},oe=(t,a)=>{a!==null&&Z(a)},S=JSON.parse(sessionStorage.getItem("user")),h={"Content-Type":"application/json",Authorization:"Bearer "+(S==null?void 0:S.accessToken)},ie=async()=>{var t;try{console.log("Fetching categories...");const a=await Ve(h,0,100);if(console.log("Categories response:",a),a.data.code===200){const s=((t=a.data.data)==null?void 0:t.content)||a.data.data||[];if(console.log("Categories data:",s),Array.isArray(s))y(s),console.log("Categories set successfully:",s.length);else{console.error("Categories data is not an array:",s);try{const c=await Ge(h);if(c.data.code===200){const D=c.data.data||c.data||[];Array.isArray(D)?(y(D),console.log("Categories set from fallback:",D.length)):y([])}else y([])}catch(c){console.error("Fallback categories fetch failed:",c),y([])}}}else console.error("Categories API returned error code:",a.data.code),y([])}catch(a){console.error("Error fetching categories:",a),y([])}},ne=async()=>{var t,a;try{if(!S||!S.accessToken){console.error("User not authenticated"),i.fire("Error","Please login to continue","error");return}const s=await Ye(h,n,r);console.log(s);const c=((t=s.data.data)==null?void 0:t.subCategories)||[],D=((a=s.data.data)==null?void 0:a.totalCount)||0;if(c&&Array.isArray(c)){const be=c.map(u=>{var V;return{subCategoryId:u.subCategoryId,subCategoryName:u.subCategoryName,subCategoryDescription:u.subCategoryDescription,categoryId:((V=u.category)==null?void 0:V.categoryId)||null,isActive:u.isActive?"Active":"Inactive",insertedDate:u.insertedDate?_(u.insertedDate).format("L"):"N/A",updatedDate:u.updatedDate?_(u.updatedDate).format("L"):"N/A"}});B(be),U(D)}else B([]),U(0)}catch(s){console.error("Error fetching data:",s)}};g.useEffect(()=>{ne(),ie()},[ee,n,r]);const ce=async t=>{t.preventDefault();const a=le();if(Object.keys(a).length>0)M(a);else try{if(k){const s={subCategoryId:te,subCategoryName:d.subCategoryName,subCategoryDescription:d.subCategoryDescription,categoryId:d.categoryId,isActive:d.isActive};await _e(s,h)}else{const s={...d,insertedDate:new Date().toISOString(),updatedDate:new Date().toISOString()};await qe(s,h)}w({subCategoryName:"",subCategoryDescription:"",categoryId:"",isActive:!0}),A(s=>!s),v(!1)}catch(s){console.error("Error saving sub-category:",s)}},le=()=>{const t={};return(!d.subCategoryName||d.subCategoryName.trim()==="")&&(t.subCategoryName="Enter the sub-category name"),(!d.subCategoryDescription||d.subCategoryDescription.trim()==="")&&(t.subCategoryDescription="Enter the sub-category description"),(!d.categoryId||d.categoryId==="")&&(t.categoryId="Select a category"),t},E=t=>{const{name:a,value:s,checked:c}=t.target;w({...d,[a]:a==="isActive"?c:s}),M({...b,[a]:null})},de=()=>{W(!1),w({subCategoryName:"",subCategoryDescription:"",categoryId:"",isActive:!0}),v(!0)},O=async t=>{var a;W(!0),v(!0);try{const s=await Xe(t,h),c=s.data.data||s.data;ae(c.subCategoryId),w({subCategoryName:c.subCategoryName,subCategoryDescription:c.subCategoryDescription,categoryId:((a=c.category)==null?void 0:a.categoryId)||"",isActive:c.isActive})}catch(s){console.error("Error fetching sub-category details:",s)}},L=async t=>{i.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(async a=>{if(a.isConfirmed)try{await Je(t,h),A(s=>!s),i.fire({title:"Deleted!",text:"Sub-category has been deleted.",icon:"success"})}catch(s){i.fire({title:"Error!",text:"There was a problem deleting the sub-category.",icon:"error"}),console.error("Error deleting sub-category:",s)}})},ge=async t=>{try{await Ke(t,h),A(a=>!a)}catch(a){console.error("Error activating sub-category:",a)}},he=async t=>{try{await Qe(t,h),A(a=>!a)}catch(a){console.error("Error deactivating sub-category:",a)}},ue=()=>e.jsx(x,{container:!0,spacing:3,children:C.length===0?e.jsx(x,{item:!0,xs:12,children:e.jsxs(o,{sx:{textAlign:"center",py:4},children:[e.jsx(f,{variant:"h6",color:"textSecondary",children:"No sub-categories found"}),e.jsxs(f,{variant:"body2",color:"textSecondary",children:["Sub-categories array length: ",C.length]})]})}):C.map(t=>e.jsx(x,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(ke,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #F48FB1 0%, #F8BBD9 100%)",color:"#880E4F",position:"relative",overflow:"hidden","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(0,0,0,0.15)",transition:"all 0.3s ease"}},children:[e.jsx(o,{sx:{position:"absolute",top:0,right:0,width:100,height:100,background:"rgba(255,255,255,0.3)",borderRadius:"50%",transform:"translate(30px, -30px)"}}),e.jsxs(Ne,{sx:{flexGrow:1,position:"relative",zIndex:1},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Te,{sx:{bgcolor:"rgba(136, 14, 79, 0.2)",mr:2,width:40,height:40,color:"#880E4F"},children:e.jsx(G,{})}),e.jsxs(o,{children:[e.jsx(f,{variant:"h6",sx:{fontWeight:"bold",mb:.5,color:"#880E4F"},children:t.subCategoryName}),e.jsxs(o,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(q,{label:t.isActive,size:"small",sx:{bgcolor:t.isActive==="Active"?"rgba(76, 175, 80, 0.9)":"rgba(244, 67, 54, 0.9)",color:"white",fontWeight:"bold"}}),e.jsx(q,{label:t.categoryName,size:"small",sx:{bgcolor:"rgba(136, 14, 79, 0.2)",color:"#880E4F",fontWeight:"bold",fontSize:"0.7rem"}})]})]})]}),e.jsx(f,{variant:"body2",sx:{mb:2,opacity:.8,color:"#880E4F",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t.subCategoryDescription}),e.jsx(Fe,{sx:{my:1,bgcolor:"rgba(136, 14, 79, 0.2)"}}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(f,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:["ID: ",t.subCategoryId]}),e.jsx(f,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:t.insertedDate})]}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(f,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:["Updated: ",t.updatedDate]}),e.jsxs(o,{children:[e.jsx(j,{size:"small",onClick:()=>O(t.subCategoryId),sx:{color:"#880E4F","&:hover":{bgcolor:"rgba(136, 14, 79, 0.1)"}},children:e.jsx(J,{fontSize:"small"})}),e.jsx(j,{size:"small",onClick:()=>L(t.subCategoryId),sx:{color:"#880E4F","&:hover":{bgcolor:"rgba(136, 14, 79, 0.1)"}},children:e.jsx(X,{fontSize:"small"})})]})]})]})]})},t.subCategoryId))}),xe=()=>e.jsxs(Pe,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(ze,{sx:{maxHeight:440},children:e.jsxs(Be,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(We,{children:e.jsx(F,{children:z.map(t=>e.jsx(P,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx($e,{children:C.length===0?e.jsx(F,{children:e.jsx(P,{colSpan:z.length,align:"center",children:e.jsxs(o,{sx:{py:2},children:[e.jsx("div",{children:"No sub-categories found"}),e.jsxs("div",{style:{fontSize:"12px",color:"gray"},children:["Sub-categories array length: ",C.length]})]})})}):C.map(t=>e.jsx(F,{hover:!0,role:"checkbox",tabIndex:-1,children:z.map(a=>e.jsx(P,{align:a.align,children:a.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(j,{onClick:()=>O(t.subCategoryId),style:{color:"#00afb5"},children:e.jsx(J,{})}),t.isActive==="Active"?e.jsx(j,{onClick:()=>he(t.subCategoryId),style:{color:"#ff9800"},children:e.jsx(Me,{})}):e.jsx(j,{onClick:()=>ge(t.subCategoryId),style:{color:"#4caf50"},children:e.jsx(Re,{})}),e.jsx(j,{onClick:()=>L(t.subCategoryId),color:"error",children:e.jsx(X,{})})]}):a.id==="isActive"?e.jsx(o,{sx:{backgroundColor:t[a.id]==="Active"?"#4caf50":"#f44336",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"bold"},children:t[a.id]}):a.id==="subCategoryDescription"?e.jsx(o,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t[a.id]}):a.id==="categoryName"?e.jsx(o,{sx:{backgroundColor:"#e3f2fd",color:"#1976d2",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"bold"},children:t[a.id]}):t[a.id]},a.id))},t.subCategoryId))})]})}),e.jsx(Ue,{rowsPerPageOptions:[10,25,100],component:"div",count:R,rowsPerPage:r,page:n,onPageChange:re,onRowsPerPageChange:se})]});return e.jsxs(o,{sx:{mt:4},children:[e.jsxs(Oe,{title:e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx("span",{children:"Sub-Category Management"}),e.jsx(fe,{badgeContent:R,color:"primary",children:e.jsx(G,{color:"action"})})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(me,{value:$,exclusive:!0,onChange:oe,size:"small",sx:{bgcolor:"background.paper"},children:[e.jsx(H,{value:"list","aria-label":"list view",children:e.jsx(pe,{})}),e.jsx(H,{value:"card","aria-label":"card view",children:e.jsx(Ce,{})})]}),e.jsxs(N,{variant:"contained",style:{backgroundColor:"#00afb5",color:"white"},sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:de,children:["Add Sub-Category",e.jsx(He,{sx:{color:"#fff"}})]})]})]}),children:[e.jsx(x,{container:!0,spacing:Le}),$==="card"?ue():xe()]}),e.jsxs(je,{open:Q,onClose:()=>v(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(ve,{sx:{fontWeight:"bold",fontSize:"1.25rem",backgroundColor:"#f5f5f5"},children:k?"Edit Sub-Category":"Add Sub-Category"}),e.jsxs(o,{component:"form",onSubmit:ce,noValidate:!0,sx:{p:3},children:[e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,md:6,children:e.jsx(Y,{fullWidth:!0,label:"Sub-Category Name",name:"subCategoryName",value:d.subCategoryName,onChange:E,error:!!b.subCategoryName,helperText:b.subCategoryName,placeholder:"e.g., Web Development, Mobile Apps"})}),e.jsx(x,{item:!0,xs:12,md:6,children:e.jsxs(Se,{fullWidth:!0,error:!!b.categoryId,children:[e.jsx(De,{children:"Category"}),e.jsxs(Ie,{name:"categoryId",value:d.categoryId,onChange:E,label:"Category",children:[e.jsx(T,{value:"",children:e.jsx("em",{children:"Select a category"})}),I&&I.length>0?I.map(t=>e.jsx(T,{value:t.categoryId,children:t.categoryName},t.categoryId)):e.jsx(T,{disabled:!0,children:"No categories available"})]}),b.categoryId&&e.jsx(o,{sx:{color:"error.main",fontSize:"0.75rem",mt:.5},children:b.categoryId}),e.jsxs(o,{sx:{fontSize:"0.75rem",mt:.5,color:"text.secondary"},children:["Categories loaded: ",I.length]})]})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(Y,{fullWidth:!0,label:"Sub-Category Description",name:"subCategoryDescription",value:d.subCategoryDescription,onChange:E,error:!!b.subCategoryDescription,helperText:b.subCategoryDescription,placeholder:"Describe the sub-category and its characteristics",multiline:!0,rows:4})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(we,{control:e.jsx(Ae,{checked:d.isActive,onChange:E,name:"isActive",color:"primary"}),label:"Active Status"})})]}),e.jsxs(Ee,{children:[e.jsx(N,{type:"submit",variant:"contained",style:{backgroundColor:"#00afb5",color:"white"},children:k?"Update":"Add"}),e.jsx(N,{onClick:()=>v(!1),style:{color:"#00afb5"},children:"Cancel"})]})]})]})]})};export{ot as default};
