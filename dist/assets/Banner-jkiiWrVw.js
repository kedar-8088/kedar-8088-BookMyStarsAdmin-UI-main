import{u as te,j as t,d as v,r as ae,ad as re,ae as se,af as ne,ag as U,ah as R,ai as ie,X as W,aj as oe,ak as le,al as de,am as ce,an as me,a as O,t as N,n as b,ao as fe}from"./mui-BHd6aP3D.js";import{r as s}from"./react-CeAUEJ0P.js";import{M as ue,g as he,S as B,B as M}from"./index-CqEkO1RD.js";import{f as ge,g as pe,d as xe,u as ve,a as be}from"./BannerApi-DX5RZjMm.js";import{d as ye,h as L}from"./Add-Hd0l8K7I.js";import{a as $}from"./vendor-BhB35ZXg.js";const je=({filePath:o})=>{const[c,l]=s.useState(""),d=JSON.parse(sessionStorage.getItem("user"));return s.useEffect(()=>o?((async()=>{try{const m=await $.get(`${M}/bookmystarsadmin/file/downloadFile/?filePath=${encodeURIComponent(o)}`,{headers:{Authorization:`Bearer ${d==null?void 0:d.accessToken}`},responseType:"blob"}),g=new Blob([m.data],{type:m.headers["content-type"]}),f=URL.createObjectURL(g);l(f)}catch(m){console.error("Error fetching image:",m),l("")}})(),()=>{c&&URL.revokeObjectURL(c)}):void 0,[o,d==null?void 0:d.accessToken]),c?t.jsx("img",{src:c,style:{width:80,height:50},alt:"Advertisement"}):"Loading..."},z=[{id:"advertisementId",label:"ID"},{id:"advertisementName",label:"Name",minWidth:100},{id:"description",label:"Description",minWidth:100},{id:"file",label:"File"},{id:"createdBy",label:"Created By",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],Te=()=>{te();const[o,c]=s.useState(0),[l,d]=s.useState(10),[y,m]=s.useState([]),[g,f]=s.useState(!1),[j,C]=s.useState(!1),[n,p]=s.useState({advertisementName:"",description:"",fileName:""}),[u,I]=s.useState({}),[Ne,w]=s.useState(""),[Be,D]=s.useState(""),[E,H]=s.useState(null),[Y,S]=s.useState(!1),[T,k]=s.useState(null),A=s.useRef(null),G=(e,r)=>{c(r)},J=e=>{d(+e.target.value),c(0)},h=JSON.parse(sessionStorage.getItem("user")),P=h==null?void 0:h.accessToken,x={"Content-Type":"application/json",...P?{Authorization:`Bearer ${P}`}:{}},_=async()=>{try{const e=await ge(o,l,x),r=e.data.content;if(console.log(e.data.content),r){const a=r.map(i=>({advertisementId:i.advertisementId,advertisementName:i.advertisementName,description:i.description,file:i.filePath?t.jsx(je,{filePath:i.filePath}):"NO IMAGE FOUND",insertedDate:L(i.insertedDate).format("L"),updatedDate:L(i.updatedDate).format("L"),createdBy:i.createdBy?i.createdBy.userName:"No User",updatedBy:i.updatedBy?i.updatedBy.userName:"No User"}));m(a)}else m([])}catch(e){console.error("Error fetching data:",e)}};s.useEffect(()=>{_()},[Y,o,l]),s.useEffect(()=>{if(g)try{document.activeElement&&document.activeElement.blur()}catch{}},[g]);const q=async e=>{e.preventDefault();const r=K();if(Object.keys(r).length>0)I(r);else try{if(j){if(!T){console.error("Cannot update: missing advertisementId");return}const a={...n,advertisementId:T,updatedBy:{userId:h.userId}};await ve(a,x)}else{const a={...n,createdBy:{userId:h.userId}};await be(a,x)}p({advertisementName:"",description:"",fileName:""}),A.current.value=null,S(a=>!a),f(!1)}catch(a){console.error("Error saving advertisement:",a)}},V=async e=>{if(e.preventDefault(),!E){w("Please select a file");return}const r=new FormData;r.append("file",E);try{const a=await $.post(`${M}/bookmystarsadmin/file/uploadFile`,r,{headers:{"content-type":"multipart/form-data",Authorization:"Bearer "+h.accessToken}});D(a.data.fileName),alert(a.data.message),p({...n,fileName:a.data.fileName}),w("")}catch(a){console.error("Error uploading file:",a)}},X=e=>{D(e.target.files[0].name),H(e.target.files[0])},K=()=>{const e={};return(!n.advertisementName||n.advertisementName.trim()==="")&&(e.advertisementName="Enter the Advertisement name"),(!n.description||n.description.trim()==="")&&(e.description="Enter the description"),(!n.fileName||n.fileName.trim()==="")&&(e.fileName="Select the file"),e},F=e=>{p({...n,[e.target.name]:e.target.value,createdBy:{userId:h.userId}}),I({...u,[e.target.name]:null})},Q=()=>{C(!1),p({advertisementName:"",description:"",fileName:""}),f(!0)},Z=async e=>{C(!0),f(!0),k(e);try{const a=(await pe(e,x)).data;k(a.advertisementId),p({advertisementName:a.advertisementName,description:a.description,fileName:a.fileName})}catch(r){console.error("Error fetching advertisement details:",r)}},ee=async e=>{B.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(async r=>{if(r.isConfirmed)try{await xe(e,x),S(a=>!a),B.fire({title:"Deleted!",text:"Your file has been deleted.",icon:"success"})}catch(a){B.fire({title:"Error!",text:"There was a problem deleting the record.",icon:"error"}),console.error("Error deleting qualification:",a)}})};return t.jsxs(ue,{title:t.jsxs(O,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("span",{children:"Banner"}),t.jsxs(b,{variant:"contained",style:{backgroundColor:"#00afb5",color:"white"},sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:Q,children:["Add",t.jsx(ye,{sx:{color:"#fff"}})]})]}),children:[t.jsx(v,{container:!0,spacing:he}),t.jsxs(ae,{sx:{width:"100%",overflow:"hidden"},children:[t.jsx(re,{sx:{maxHeight:440},children:t.jsxs(se,{stickyHeader:!0,"aria-label":"sticky table",children:[t.jsx(ne,{children:t.jsx(U,{children:z.map(e=>t.jsx(R,{align:e.align,style:{minWidth:e.minWidth,fontWeight:600,fontSize:15},children:e.label},e.id))})}),t.jsx(ie,{children:y.slice(o*l,o*l+l).map(e=>t.jsx(U,{hover:!0,role:"checkbox",tabIndex:-1,children:z.map(r=>t.jsx(R,{align:r.align,children:r.id==="actions"?t.jsxs(t.Fragment,{children:[t.jsx(W,{onClick:()=>Z(e.advertisementId),style:{color:"#00afb5"},children:t.jsx(oe,{})}),t.jsx(W,{onClick:()=>ee(e.advertisementId),color:"error",children:t.jsx(le,{})})]}):e[r.id]},r.id))},e.advertisementId))})]})}),t.jsx(de,{rowsPerPageOptions:[10,25,100],component:"div",count:y.length,rowsPerPage:l,page:o,onPageChange:G,onRowsPerPageChange:J})]}),t.jsxs(ce,{open:g,onClose:()=>f(!1),fullWidth:!0,maxWidth:"md",children:[t.jsx(me,{sx:{fontWeight:"bold",fontSize:"1.25rem",backgroundColor:"#f5f5f5"},children:j?"Edit Advertisement":"Add Advertisement"}),t.jsxs(O,{component:"form",onSubmit:q,noValidate:!0,sx:{p:3},children:[t.jsxs(v,{container:!0,spacing:2,children:[t.jsx(v,{item:!0,xs:12,children:t.jsx(N,{fullWidth:!0,label:"Advertisement Name",name:"advertisementName",value:n.advertisementName,onChange:F,error:!!u.advertisementName,helperText:u.advertisementName})}),t.jsx(v,{item:!0,xs:12,children:t.jsx(N,{fullWidth:!0,label:"Description",name:"description",value:n.description,onChange:F,error:!!u.description,helperText:u.description,multiline:!0,rows:3})}),t.jsxs(v,{item:!0,xs:12,children:[t.jsx(N,{margin:"normal",fullWidth:!0,id:"fileName",label:"File Name",name:"fileName",autoComplete:"fileName",value:n.fileName,disabled:!0,helperText:u.fileName,error:!!u.fileName,InputProps:{endAdornment:t.jsx(b,{variant:"contained",style:{backgroundColor:"#00afb5",color:"white"},onClick:V,children:"Upload"})}}),t.jsx("input",{type:"file",onChange:X,ref:A,style:{marginTop:20}})]})]}),t.jsxs(fe,{children:[t.jsx(b,{type:"submit",variant:"contained",style:{backgroundColor:"#00afb5",color:"white"},children:j?"Edit":"Add"}),t.jsx(b,{onClick:()=>f(!1),style:{color:"#00afb5"},children:"Cancel"})]})]})]})]})};export{Te as default};
