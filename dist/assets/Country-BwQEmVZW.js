import{u as Ce,q as _,j as e,a as u,d as C,T as b,ap as ve,aw as $,ar as je,as as Z,at as we,au as Ae,n as L,am as De,an as Ee,t as ee,Y as Ie,av as Se,ao as ke,c as Ne,f as Te,A as Pe,h as te,D as Fe,X as P,aj as oe,ak as se,r as ze,ad as Be,ae as We,af as Re,ag as O,ah as V,ai as Me,al as Ue}from"./mui-BHd6aP3D.js";import{r as m}from"./react-CeAUEJ0P.js";import{M as Le,g as Oe,S as p}from"./index-CqEkO1RD.js";import{f as Ve,u as He,a as Ye,g as Ge,d as Xe}from"./CountryApi-BoiAE3Yk.js";import{d as qe,h as ae}from"./Add-Hd0l8K7I.js";import"./vendor-BhB35ZXg.js";const H=[{id:"countryId",label:"ID"},{id:"countryName",label:"Country Name",minWidth:150},{id:"countryCode",label:"Country Code",minWidth:120},{id:"isActive",label:"Status",align:"center"},{id:"insertedDate",label:"Created Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],et=()=>{const Y=Ce(),c=_(Y.breakpoints.down("sm")),re=_(Y.breakpoints.down("md")),[I,G]=m.useState(0),[S,ne]=m.useState(10),[w,F]=m.useState([]),[X,z]=m.useState([]),[ie,A]=m.useState(!1),[k,N]=m.useState(!1),[q,le]=m.useState("list"),[d,D]=m.useState({countryName:"",countryCode:"",isActive:!0}),[v,E]=m.useState({}),[ce,B]=m.useState(!1),[T,W]=m.useState(null),[J,R]=m.useState(0),de=(t,o)=>{G(o)},ue=t=>{ne(+t.target.value),G(0)},ge=(t,o)=>{o!==null&&le(o)},i=JSON.parse(sessionStorage.getItem("user"));console.log("Current user data:",i);const j={"Content-Type":"application/json",Authorization:"Bearer "+(i==null?void 0:i.accessToken)},xe=async()=>{var t,o,a,y,f;try{if(!i||!i.accessToken){console.error("User not authenticated"),p.fire("Error","Please login to continue","error");return}console.log("Fetching countries with page:",I,"rowsPerPage:",S);const r=await Ve(j,I,S);console.log("Full API response:",r.data);const g=((t=r==null?void 0:r.data)==null?void 0:t.body)??(r==null?void 0:r.data);console.log("Response body:",g);const l=g==null?void 0:g.data;console.log("Data node:",l);const s=(l==null?void 0:l.content)||(l==null?void 0:l.countries)||l||[],x=l!=null&&l.totalElements||l!=null&&l.totalCount||Array.isArray(s)?s.length:0;if(console.log("Fetched data:",s),console.log("Total count from API:",x),s&&Array.isArray(s)){z(s);const n=s.map(h=>{console.log("Country data:",h);const be=h.isActive!==void 0?h.isActive:h.active!==void 0?h.active:!0;return{countryId:h.countryId,countryName:h.countryName||"N/A",countryCode:h.countryCode||"N/A",isActive:be?"Active":"Inactive",insertedDate:h.insertedDate?ae(h.insertedDate).format("L"):"N/A",updatedDate:h.updatedDate?ae(h.updatedDate).format("L"):"N/A"}});console.log("Processed table data:",n),F(n),R(x)}else console.log("No valid data found, setting empty arrays"),F([]),z([]),R(0)}catch(r){console.error("Error fetching data:",r);let g="Failed to load countries. Please try again.";((o=r==null?void 0:r.response)==null?void 0:o.status)===401?g="Authentication failed. Please login again.":((a=r==null?void 0:r.response)==null?void 0:a.status)===403?g="You do not have permission to access countries.":(f=(y=r==null?void 0:r.response)==null?void 0:y.data)!=null&&f.message&&(g=r.response.data.message),p.fire("Error",g,"error"),F([]),z([]),R(0)}};m.useEffect(()=>{xe()},[ce,I,S]);const he=async t=>{var a,y,f,r,g,l;t.preventDefault();const o=me();if(Object.keys(o).length>0)E(o);else try{if(k){if(T==null){console.error("Cannot update: missing countryId"),p.fire("Error","Cannot update: missing country ID","error");return}const s={countryId:parseInt(T),countryName:((a=d.countryName)==null?void 0:a.trim())||"",countryCode:((y=d.countryCode)==null?void 0:y.trim())||"",isActive:!!d.isActive,updatedBy:i!=null&&i.userId?{userId:parseInt(i.userId,10),userName:i.userName||i.username||"admin"}:{userId:1,userName:"admin"}},x={countryId:parseInt(T),countryName:((f=d.countryName)==null?void 0:f.trim())||"",countryCode:((r=d.countryCode)==null?void 0:r.trim())||"",isActive:!!d.isActive};console.log("Sending update data:",s),console.log("Headers being sent:",j);const n=await He(s,j);if(n.success)console.log("Country updated successfully:",n.message),p.fire("Success",n.message,"success");else throw new Error(n.message||"Update operation failed")}else{const s={countryName:((g=d.countryName)==null?void 0:g.trim())||"",countryCode:((l=d.countryCode)==null?void 0:l.trim())||"",isActive:!!d.isActive,insertedBy:i!=null&&i.userId?{userId:parseInt(i.userId,10),userName:i.userName||i.username||"admin"}:{userId:1,userName:"admin"}};console.log("Sending add data:",s),await Ye(s,j)}D({countryName:"",countryCode:"",isActive:!0}),E({}),B(s=>!s),U()}catch(s){console.error("Error saving country:",s),p.fire("Error","Failed to save country. Please try again.","error")}},me=()=>{const t={};return(!d.countryName||d.countryName.trim()==="")&&(t.countryName="Enter the country name"),(!d.countryCode||d.countryCode.trim()==="")&&(t.countryCode="Enter the country code"),k&&!T&&(t.general="Country ID is required for update"),t},M=t=>{const{name:o,value:a,checked:y}=t.target;D({...d,[o]:o==="isActive"?y:a}),E({...v,[o]:null})},ye=()=>{N(!1),D({countryName:"",countryCode:"",isActive:!0}),E({}),A(!0)},U=()=>{A(!1),N(!1),D({countryName:"",countryCode:"",isActive:!0}),E({}),W(null)},K=async t=>{var a,y,f,r,g,l;if(!t||t<=0){console.error("Invalid country ID:",t),p.fire("Error","Invalid country ID","error");return}if(!i||!i.accessToken){console.error("User not authenticated"),p.fire("Error","Please login to continue","error");return}const o=X.find(s=>s.countryId===t);if(o){console.log("Using existing country data for edit:",o),N(!0),A(!0),W(t);const s=o.isActive!==void 0?o.isActive:o.active!==void 0?o.active:!0;D({countryName:o.countryName||"",countryCode:o.countryCode||"",isActive:!!s});return}N(!0),A(!0);try{console.log("Country not found in list, attempting API call for ID:",t);const s=await Ge(t,j);console.log("API response for country details:",s);const x=((a=s==null?void 0:s.data)==null?void 0:a.body)??(s==null?void 0:s.data),n=(x==null?void 0:x.data)||x;if(n&&n.countryId){console.log("Country details for edit:",n);const h=n.isActive!==void 0?n.isActive:n.active!==void 0?n.active:!0;W(n.countryId),D({countryName:n.countryName||"",countryCode:n.countryCode||"",isActive:!!h})}else console.error("Invalid country data received:",n),p.fire("Error","Invalid country data received from server","error"),A(!1)}catch(s){console.error("Error fetching country details:",s);let x="Failed to load country details. Please try again.";((y=s==null?void 0:s.response)==null?void 0:y.status)===404?(x=`Country with ID ${t} not found. It may have been deleted.`,B(n=>!n)):((f=s==null?void 0:s.response)==null?void 0:f.status)===401?x="Authentication failed. Please login again.":((r=s==null?void 0:s.response)==null?void 0:r.status)===403?x="You do not have permission to access this country.":(l=(g=s==null?void 0:s.response)==null?void 0:g.data)!=null&&l.message&&(x=s.response.data.message),p.fire("Error",x,"error"),A(!1)}},Q=async t=>{p.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(async o=>{if(o.isConfirmed)try{console.log("=== HANDLE DELETE DEBUG ==="),console.log("User confirmed deletion for country ID:",t),console.log("Headers being sent:",j);const a=await Xe(t,j);if(console.log("=== DELETE RESULT ==="),console.log("Delete result:",a),a.success){console.log("✅ Country deleted successfully, refreshing data...");const y=X.find(f=>f.countryId===t);console.log("Country still exists in local data:",y),B(f=>!f),p.fire({title:"Deleted!",text:a.message||"Country has been deleted successfully.",icon:"success"})}else throw console.log("❌ Delete result indicates failure"),new Error(a.message||"Delete operation failed")}catch(a){console.log("=== DELETE ERROR IN COMPONENT ==="),console.error("Error deleting country:",a),console.log("Error message:",a.message),console.log("Error stack:",a.stack),p.fire({title:"Error!",text:a.message||"There was a problem deleting the country.",icon:"error"})}else console.log("User cancelled deletion")})},fe=()=>e.jsx(C,{container:!0,spacing:3,children:w.length===0?e.jsx(C,{item:!0,xs:12,children:e.jsxs(u,{sx:{textAlign:"center",py:4},children:[e.jsx(b,{variant:"h6",color:"textSecondary",children:"No countries found"}),e.jsxs(b,{variant:"body2",color:"textSecondary",children:["Countries array length: ",w.length]})]})}):w.map(t=>e.jsx(C,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(Ne,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #F48FB1 0%, #F8BBD9 100%)",color:"#880E4F",position:"relative",overflow:"hidden","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(0,0,0,0.15)",transition:"all 0.3s ease"}},children:[e.jsx(u,{sx:{position:"absolute",top:0,right:0,width:100,height:100,background:"rgba(255,255,255,0.3)",borderRadius:"50%",transform:"translate(30px, -30px)"}}),e.jsxs(Te,{sx:{flexGrow:1,position:"relative",zIndex:1},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Pe,{sx:{bgcolor:"rgba(136, 14, 79, 0.2)",mr:2,width:40,height:40,color:"#880E4F"},children:e.jsx($,{})}),e.jsxs(u,{children:[e.jsx(b,{variant:"h6",sx:{fontWeight:"bold",mb:.5,color:"#880E4F"},children:t.countryName}),e.jsxs(u,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(te,{label:t.countryCode,size:"small",sx:{bgcolor:"rgba(136, 14, 79, 0.2)",color:"#880E4F",fontWeight:"bold",fontSize:"0.7rem"}}),e.jsx(te,{label:t.isActive,size:"small",sx:{bgcolor:t.isActive==="Active"?"rgba(76, 175, 80, 0.9)":"rgba(244, 67, 54, 0.9)",color:"white",fontWeight:"bold"}})]})]})]}),e.jsx(b,{variant:"body2",sx:{mb:2,opacity:.8,color:"#880E4F",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t.countryDescription}),e.jsx(Fe,{sx:{my:1,bgcolor:"rgba(136, 14, 79, 0.2)"}}),e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(b,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:["ID: ",t.countryId]}),e.jsx(b,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:t.insertedDate})]}),e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(b,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:["Updated: ",t.updatedDate]}),e.jsxs(u,{children:[e.jsx(P,{size:"small",onClick:()=>K(t.countryId),sx:{color:"#880E4F","&:hover":{bgcolor:"rgba(136, 14, 79, 0.1)"}},children:e.jsx(oe,{fontSize:"small"})}),e.jsx(P,{size:"small",onClick:()=>Q(t.countryId),sx:{color:"#880E4F","&:hover":{bgcolor:"rgba(136, 14, 79, 0.1)"}},children:e.jsx(se,{fontSize:"small"})})]})]})]})]})},t.countryId))}),pe=()=>{const t=c?H.filter(o=>["countryId","countryName","countryCode","actions"].includes(o.id)):re?H.filter(o=>!["insertedDate","updatedDate"].includes(o.id)):H;return e.jsxs(ze,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(Be,{sx:{maxHeight:440,overflowX:"auto","&::-webkit-scrollbar":{height:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"#f1f1f1"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#888",borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:"#555"}},children:e.jsxs(We,{stickyHeader:!0,"aria-label":"sticky table",sx:{minWidth:c?600:"100%"},children:[e.jsx(Re,{children:e.jsx(O,{children:t.map(o=>e.jsx(V,{align:o.align,sx:{minWidth:c?o.minWidth?Math.min(o.minWidth,100):"auto":o.minWidth,fontWeight:600,fontSize:c?13:15,whiteSpace:"nowrap",...o.id==="actions"&&{textAlign:"right"}},children:o.label},o.id))})}),e.jsx(Me,{children:w.length===0?e.jsx(O,{children:e.jsx(V,{colSpan:t.length,align:"center",children:e.jsxs(u,{sx:{py:2},children:[e.jsx("div",{children:"No countries found"}),e.jsxs("div",{style:{fontSize:"12px",color:"gray"},children:["Countries array length: ",w.length]})]})})}):w.map(o=>e.jsx(O,{hover:!0,role:"checkbox",tabIndex:-1,children:t.map(a=>e.jsx(V,{align:a.align,sx:{fontSize:c?12:14,whiteSpace:"nowrap",...a.id==="actions"&&{textAlign:"right"}},children:a.id==="actions"?e.jsxs(u,{sx:{display:"flex",gap:.5,flexWrap:"wrap",justifyContent:"flex-end"},children:[e.jsx(P,{size:c?"small":"medium",onClick:()=>K(o.countryId),style:{color:"#00afb5"},children:e.jsx(oe,{fontSize:c?"small":"medium"})}),e.jsx(P,{size:c?"small":"medium",onClick:()=>Q(o.countryId),color:"error",children:e.jsx(se,{fontSize:c?"small":"medium"})})]}):a.id==="isActive"?e.jsx(u,{sx:{backgroundColor:o[a.id]==="Active"?"#4caf50":"#f44336",color:"white",padding:c?"2px 6px":"4px 8px",borderRadius:"4px",fontSize:c?"10px":"12px",fontWeight:"bold",display:"inline-block"},children:o[a.id]}):e.jsx(b,{variant:"body2",sx:{fontSize:c?12:14,overflow:"hidden",textOverflow:"ellipsis",maxWidth:c?120:"none"},children:o[a.id]})},a.id))},o.countryId))})]})}),e.jsx(Ue,{rowsPerPageOptions:c?[10,25]:[10,25,100],component:"div",count:J,rowsPerPage:S,page:I,onPageChange:de,onRowsPerPageChange:ue,sx:{overflowX:"auto","& .MuiTablePagination-toolbar":{flexWrap:"wrap",gap:1},"& .MuiTablePagination-selectLabel":{fontSize:c?12:14},"& .MuiTablePagination-displayedRows":{fontSize:c?12:14}}})]})};return e.jsxs(u,{sx:{mt:4,px:{xs:1,sm:2}},children:[e.jsxs(Le,{title:e.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},gap:2,width:"100%"},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsx(b,{variant:"h4",sx:{fontSize:{xs:"1.2rem",sm:"1.5rem"}},children:"Country Management"}),e.jsx(ve,{badgeContent:J,color:"primary",children:e.jsx($,{color:"action"})})]}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",width:{xs:"100%",sm:"auto"},justifyContent:{xs:"flex-start",sm:"flex-end"}},children:[e.jsxs(je,{value:q,exclusive:!0,onChange:ge,size:"small",sx:{bgcolor:"background.paper"},children:[e.jsx(Z,{value:"list","aria-label":"list view",children:e.jsx(we,{})}),e.jsx(Z,{value:"card","aria-label":"card view",children:e.jsx(Ae,{})})]}),e.jsxs(L,{variant:"contained",style:{backgroundColor:"#00afb5",color:"white"},sx:{display:"flex",alignItems:"center",fontSize:{xs:"13px",sm:"15px"},whiteSpace:"nowrap",width:{xs:"100%",sm:"auto"}},onClick:ye,children:[c?"Add":"Add Country",e.jsx(qe,{sx:{color:"#fff",ml:.5}})]})]})]}),children:[e.jsx(C,{container:!0,spacing:Oe}),q==="card"?fe():pe()]}),e.jsxs(De,{open:ie,onClose:U,fullWidth:!0,maxWidth:c?"xs":"md",fullScreen:c,disableEscapeKeyDown:!1,"aria-labelledby":"country-dialog-title","aria-describedby":"country-dialog-description",children:[e.jsx(Ee,{id:"country-dialog-title",sx:{fontWeight:"bold",fontSize:"1.25rem",backgroundColor:"#f5f5f5"},children:k?"Edit Country":"Add Country"}),e.jsxs(u,{component:"form",onSubmit:he,noValidate:!0,sx:{p:{xs:2,sm:3}},children:[v.general&&e.jsx(u,{sx:{mb:2,p:1,bgcolor:"error.light",color:"error.contrastText",borderRadius:1},children:v.general}),e.jsxs(C,{container:!0,spacing:2,children:[e.jsx(C,{item:!0,xs:12,children:e.jsx(ee,{fullWidth:!0,label:"Country Name",name:"countryName",value:d.countryName,onChange:M,error:!!v.countryName,helperText:v.countryName})}),e.jsx(C,{item:!0,xs:12,children:e.jsx(ee,{fullWidth:!0,label:"Country Code",name:"countryCode",value:d.countryCode,onChange:M,error:!!v.countryCode,helperText:v.countryCode})}),e.jsx(C,{item:!0,xs:12,children:e.jsx(Ie,{control:e.jsx(Se,{checked:!!d.isActive,onChange:M,name:"isActive",color:"primary"}),label:"Active Status"})})]}),e.jsxs(ke,{children:[e.jsx(L,{type:"submit",variant:"contained",style:{backgroundColor:"#00afb5",color:"white"},children:k?"Update":"Add"}),e.jsx(L,{onClick:U,style:{color:"#00afb5"},children:"Cancel"})]})]})]})]})};export{et as default};
