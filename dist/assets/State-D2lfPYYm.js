import{u as Ie,q as Q,j as e,a as d,d as g,T as f,ap as Ae,aA as Z,ar as we,as as _,at as Ne,au as De,n as B,am as Ee,an as ke,t as ee,U as Te,V as ze,ay as Fe,az as te,Y as Pe,av as We,ao as Be,c as Me,f as Re,A as Le,h as ae,D as Ve,X as I,aj as se,ak as oe,r as Ue,ad as $e,ae as Oe,af as Ye,ag as M,ah as R,ai as He,aB as Xe,aC as Ge,al as qe}from"./mui-BHd6aP3D.js";import{r as x}from"./react-CeAUEJ0P.js";import{M as Je,g as Ke,S as p}from"./index-CqEkO1RD.js";import{f as Qe,u as Ze,a as _e,b as et,d as tt,c as at,e as st}from"./StateApi-CecQQoMq.js";import{b as ot}from"./CountryApi-BoiAE3Yk.js";import{d as rt,h as re}from"./Add-Hd0l8K7I.js";import"./vendor-BhB35ZXg.js";const L=[{id:"stateId",label:"ID"},{id:"stateName",label:"State Name",minWidth:150},{id:"stateCode",label:"State Code",minWidth:120},{id:"countryName",label:"Country",minWidth:120},{id:"isActive",label:"Status",align:"center"},{id:"insertedDate",label:"Created Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],ht=()=>{const V=Ie(),i=Q(V.breakpoints.down("sm")),ie=Q(V.breakpoints.down("md")),[D,U]=x.useState(0),[E,ne]=x.useState(10),[v,k]=x.useState([]),[le,C]=x.useState(!1),[A,T]=x.useState(!1),[$,ce]=x.useState("list"),[n,j]=x.useState({stateName:"",stateCode:"",countryId:"",isActive:!0}),[h,S]=x.useState({}),[de,w]=x.useState(!1),[z,O]=x.useState(null),[Y,F]=x.useState(0),[y,ue]=x.useState([]),xe=(a,t)=>{U(t)},he=a=>{ne(+a.target.value),U(0)},me=(a,t)=>{t!==null&&ce(t)},c=JSON.parse(sessionStorage.getItem("user"));console.log("Current user data:",c);const b={"Content-Type":"application/json",Authorization:"Bearer "+(c==null?void 0:c.accessToken)},H=async()=>{var a;try{if(!c||!c.accessToken){console.error("User not authenticated"),p.fire("Error","Please login to continue","error");return}const t=await Qe(b,D,E),s=((a=t==null?void 0:t.data)==null?void 0:a.body)??(t==null?void 0:t.data),o=s==null?void 0:s.data,r=(o==null?void 0:o.content)||(o==null?void 0:o.states)||o||[],m=(o==null?void 0:o.totalElements)??(o==null?void 0:o.totalCount)??(Array.isArray(r)?r.length:0);if(r&&Array.isArray(r)){console.log("States data:",r),console.log("Available countries:",y);const u=r.map(l=>{console.log("Processing state:",l),console.log("Available countries for lookup:",y);const q=l.countryId;console.log(`State ${l.stateName} - stateCountryId: ${q}`);const W=y.find(Se=>Se.countryId==q),J=W?W.countryName:l.countryName||"N/A";console.log(`State ${l.stateName} - found country:`,W,"countryName:",J);const K=l.isActive!==void 0?l.isActive:l.active!==void 0?l.active:!0;return console.log(`State ${l.stateName} - isActive field: ${l.isActive}, active field: ${l.active}, final value: ${K}`),{stateId:l.stateId,stateName:l.stateName||"N/A",stateCode:l.stateCode||"N/A",countryName:J,isActive:K?"Active":"Inactive",insertedDate:l.insertedDate?re(l.insertedDate).format("L"):"N/A",updatedDate:l.updatedDate?re(l.updatedDate).format("L"):"N/A"}});k(u),F(m)}else k([]),F(0)}catch(t){console.error("Error fetching data:",t),p.fire("Error","Failed to load states. Please try again.","error"),k([]),F(0)}},ge=async()=>{var a;try{const t=await ot(b);console.log("Countries API response:",t.data);const s=((a=t==null?void 0:t.data)==null?void 0:a.body)??(t==null?void 0:t.data);console.log("Response body:",s);const o=s==null?void 0:s.data;console.log("Data node:",o);const r=o||[];if(console.log("Fetched countries:",r),Array.isArray(r)){const m=r.map(u=>({countryId:u.countryId,countryName:u.countryName||"N/A",countryCode:u.countryCode||"N/A",isActive:u.isActive!==void 0?u.isActive:!0}));console.log("Processed countries:",m),ue(m)}}catch(t){console.error("Error fetching countries:",t)}};x.useEffect(()=>{(async()=>{try{await ge(),setTimeout(()=>{H()},100)}catch(t){console.error("Error loading data:",t)}})()},[de,D,E]),x.useEffect(()=>{y.length>0?(console.log("Countries loaded, refreshing states data"),H()):console.log("No countries loaded yet, countries length:",y.length)},[y]);const fe=async a=>{var s,o,r,m;a.preventDefault();const t=pe();if(Object.keys(t).length>0)S(t);else try{if(A){if(z==null){console.error("Cannot update: missing stateId"),p.fire("Error","Cannot update: missing state ID","error");return}const u={stateId:z,stateName:((s=n.stateName)==null?void 0:s.trim())||"",stateCode:((o=n.stateCode)==null?void 0:o.trim())||"",countryId:n.countryId,isActive:!!n.isActive,updatedBy:c!=null&&c.userId?{userId:c.userId,userName:c.userName||c.username||"admin"}:{userId:1,userName:"admin"}};console.log("Sending update data:",u),await Ze(u,b)}else{const u={stateName:((r=n.stateName)==null?void 0:r.trim())||"",stateCode:((m=n.stateCode)==null?void 0:m.trim().toUpperCase())||"",countryId:parseInt(n.countryId,10),isActive:!!n.isActive,insertedBy:c!=null&&c.userId?{userId:parseInt(c.userId,10),userName:c.userName||c.username||"admin"}:{userId:1,userName:"admin"}};console.log("Sending add data:",u),await _e(u,b)}j({stateName:"",stateCode:"",countryId:"",isActive:!0}),S({}),w(u=>!u),P()}catch(u){console.error("Error saving state:",u),p.fire("Error","Failed to save state. Please try again.","error")}},pe=()=>{const a={};return(!n.stateName||n.stateName.trim()==="")&&(a.stateName="Enter the state name"),(!n.stateCode||n.stateCode.trim()==="")&&(a.stateCode="Enter the state code"),(!n.countryId||n.countryId==="")&&(a.countryId="Select a country"),A&&!z&&(a.general="State ID is required for update"),n.stateCode&&!/^[A-Z]{2,3}$/.test(n.stateCode.toUpperCase())&&(a.stateCode="State code must be 2-3 uppercase letters"),a},N=a=>{const{name:t,value:s,checked:o}=a.target;j({...n,[t]:t==="isActive"?o:s}),S({...h,[t]:null})},be=()=>{T(!1),j({stateName:"",stateCode:"",countryId:"",isActive:!0}),S({}),C(!0)},P=()=>{C(!1),T(!1),j({stateName:"",stateCode:"",countryId:"",isActive:!0}),S({}),O(null)},X=async a=>{var t;T(!0),C(!0);try{console.log("Fetching state details for editing, ID:",a);const s=await et(a,b);console.log("Edit state response:",s);const o=((t=s==null?void 0:s.data)==null?void 0:t.body)??(s==null?void 0:s.data);console.log("Response body:",o);const r=(o==null?void 0:o.data)||o;if(r&&r.stateId){console.log("State details for edit:",r);const m=r.isActive!==void 0?r.isActive:r.active!==void 0?r.active:!0;O(r.stateId),j({stateName:r.stateName||"",stateCode:r.stateCode||"",countryId:r.countryId||"",isActive:!!m})}else p.fire("Error","Failed to load state details","error"),C(!1)}catch(s){console.error("Error fetching state details:",s),p.fire("Error","Failed to load state details. Please try again.","error"),C(!1)}},ye=async a=>{try{await st(a,b),w(t=>!t)}catch(t){console.error("Error activating state:",t)}},ve=async a=>{try{await at(a,b),w(t=>!t)}catch(t){console.error("Error deactivating state:",t)}},G=async a=>{p.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(async t=>{if(t.isConfirmed)try{await tt(a,b),w(s=>!s),p.fire({title:"Deleted!",text:"State has been deleted.",icon:"success"})}catch(s){p.fire({title:"Error!",text:"There was a problem deleting the state.",icon:"error"}),console.error("Error deleting state:",s)}})},Ce=()=>e.jsx(g,{container:!0,spacing:3,children:v.length===0?e.jsx(g,{item:!0,xs:12,children:e.jsxs(d,{sx:{textAlign:"center",py:4},children:[e.jsx(f,{variant:"h6",color:"textSecondary",children:"No states found"}),e.jsxs(f,{variant:"body2",color:"textSecondary",children:["States array length: ",v.length]})]})}):v.map(a=>e.jsx(g,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(Me,{sx:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #F48FB1 0%, #F8BBD9 100%)",color:"#880E4F",position:"relative",overflow:"hidden","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(0,0,0,0.15)",transition:"all 0.3s ease"}},children:[e.jsx(d,{sx:{position:"absolute",top:0,right:0,width:100,height:100,background:"rgba(255,255,255,0.3)",borderRadius:"50%",transform:"translate(30px, -30px)"}}),e.jsxs(Re,{sx:{flexGrow:1,position:"relative",zIndex:1},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Le,{sx:{bgcolor:"rgba(136, 14, 79, 0.2)",mr:2,width:40,height:40,color:"#880E4F"},children:e.jsx(Z,{})}),e.jsxs(d,{children:[e.jsx(f,{variant:"h6",sx:{fontWeight:"bold",mb:.5,color:"#880E4F"},children:a.stateName}),e.jsxs(d,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(ae,{label:a.stateCode,size:"small",sx:{bgcolor:"rgba(136, 14, 79, 0.2)",color:"#880E4F",fontWeight:"bold",fontSize:"0.7rem"}}),e.jsx(ae,{label:a.isActive,size:"small",sx:{bgcolor:a.isActive==="Active"?"rgba(76, 175, 80, 0.9)":"rgba(244, 67, 54, 0.9)",color:"white",fontWeight:"bold"}})]})]})]}),e.jsx(f,{variant:"body2",sx:{mb:2,opacity:.8,color:"#880E4F",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:a.stateDescription}),e.jsx(Ve,{sx:{my:1,bgcolor:"rgba(136, 14, 79, 0.2)"}}),e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(f,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:["ID: ",a.stateId]}),e.jsx(f,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:a.insertedDate})]}),e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(f,{variant:"caption",sx:{opacity:.7,color:"#880E4F"},children:["Updated: ",a.updatedDate]}),e.jsxs(d,{children:[e.jsx(I,{size:"small",onClick:()=>X(a.stateId),sx:{color:"#880E4F","&:hover":{bgcolor:"rgba(136, 14, 79, 0.1)"}},children:e.jsx(se,{fontSize:"small"})}),e.jsx(I,{size:"small",onClick:()=>G(a.stateId),sx:{color:"#880E4F","&:hover":{bgcolor:"rgba(136, 14, 79, 0.1)"}},children:e.jsx(oe,{fontSize:"small"})})]})]})]})]})},a.stateId))}),je=()=>{const a=i?L.filter(t=>["stateId","stateName","stateCode","actions"].includes(t.id)):ie?L.filter(t=>!["insertedDate","updatedDate"].includes(t.id)):L;return e.jsxs(Ue,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx($e,{sx:{maxHeight:440,overflowX:"auto","&::-webkit-scrollbar":{height:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"#f1f1f1"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#888",borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:"#555"}},children:e.jsxs(Oe,{stickyHeader:!0,"aria-label":"sticky table",sx:{minWidth:i?600:"100%"},children:[e.jsx(Ye,{children:e.jsx(M,{children:a.map(t=>e.jsx(R,{align:t.align,sx:{minWidth:i?t.minWidth?Math.min(t.minWidth,100):"auto":t.minWidth,fontWeight:600,fontSize:i?13:15,whiteSpace:"nowrap",...t.id==="actions"&&{textAlign:"center"}},children:t.label},t.id))})}),e.jsx(He,{children:v.length===0?e.jsx(M,{children:e.jsx(R,{colSpan:a.length,align:"center",children:e.jsxs(d,{sx:{py:2},children:[e.jsx("div",{children:"No states found"}),e.jsxs("div",{style:{fontSize:"12px",color:"gray"},children:["States array length: ",v.length]})]})})}):v.map(t=>e.jsx(M,{hover:!0,role:"checkbox",tabIndex:-1,children:a.map(s=>e.jsx(R,{align:s.align,sx:{fontSize:i?12:14,whiteSpace:"nowrap",...s.id==="actions"&&{textAlign:"right"}},children:s.id==="actions"?e.jsxs(d,{sx:{display:"flex",gap:.5,flexWrap:"wrap",justifyContent:"flex-end"},children:[e.jsx(I,{size:i?"small":"medium",onClick:()=>X(t.stateId),style:{color:"#00afb5"},children:e.jsx(se,{fontSize:i?"small":"medium"})}),e.jsx(I,{size:i?"small":"medium",onClick:()=>G(t.stateId),color:"error",children:e.jsx(oe,{fontSize:i?"small":"medium"})}),e.jsx(I,{size:i?"small":"medium",onClick:()=>t.isActive==="Active"?ve(t.stateId):ye(t.stateId),color:t.isActive==="Active"?"warning":"success",children:t.isActive==="Active"?e.jsx(Xe,{fontSize:i?"small":"medium"}):e.jsx(Ge,{fontSize:i?"small":"medium"})})]}):s.id==="isActive"?e.jsx(d,{sx:{backgroundColor:t[s.id]==="Active"?"#4caf50":"#f44336",color:"white",padding:i?"2px 6px":"4px 8px",borderRadius:"4px",fontSize:i?"10px":"12px",fontWeight:"bold",display:"inline-block"},children:t[s.id]}):e.jsx(f,{variant:"body2",sx:{fontSize:i?12:14,overflow:"hidden",textOverflow:"ellipsis",maxWidth:i?120:"none"},children:t[s.id]})},s.id))},t.stateId))})]})}),e.jsx(qe,{rowsPerPageOptions:i?[10,25]:[10,25,100],component:"div",count:Y,rowsPerPage:E,page:D,onPageChange:xe,onRowsPerPageChange:he,sx:{overflowX:"auto","& .MuiTablePagination-toolbar":{flexWrap:"wrap",gap:1},"& .MuiTablePagination-selectLabel":{fontSize:i?12:14},"& .MuiTablePagination-displayedRows":{fontSize:i?12:14}}})]})};return e.jsxs(d,{sx:{mt:4,px:{xs:1,sm:2}},children:[e.jsxs(Je,{title:e.jsxs(d,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},gap:2,width:"100%"},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsx(f,{variant:"h4",sx:{fontSize:{xs:"1.2rem",sm:"1.5rem"}},children:"State Management"}),e.jsx(Ae,{badgeContent:Y,color:"primary",children:e.jsx(Z,{color:"action"})})]}),e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",width:{xs:"100%",sm:"auto"},justifyContent:{xs:"flex-start",sm:"flex-end"}},children:[e.jsxs(we,{value:$,exclusive:!0,onChange:me,size:"small",sx:{bgcolor:"background.paper"},children:[e.jsx(_,{value:"list","aria-label":"list view",children:e.jsx(Ne,{})}),e.jsx(_,{value:"card","aria-label":"card view",children:e.jsx(De,{})})]}),e.jsxs(B,{variant:"contained",style:{backgroundColor:"#00afb5",color:"white"},sx:{display:"flex",alignItems:"center",fontSize:{xs:"13px",sm:"15px"},whiteSpace:"nowrap",width:{xs:"100%",sm:"auto"}},onClick:be,children:[i?"Add":"Add State",e.jsx(rt,{sx:{color:"#fff",ml:.5}})]})]})]}),children:[e.jsx(g,{container:!0,spacing:Ke}),$==="card"?Ce():je()]}),e.jsxs(Ee,{open:le,onClose:P,fullWidth:!0,maxWidth:i?"xs":"md",fullScreen:i,disableEscapeKeyDown:!1,"aria-labelledby":"state-dialog-title","aria-describedby":"state-dialog-description",children:[e.jsx(ke,{id:"state-dialog-title",sx:{fontWeight:"bold",fontSize:"1.25rem",backgroundColor:"#f5f5f5"},children:A?"Edit State":"Add State"}),e.jsxs(d,{component:"form",onSubmit:fe,noValidate:!0,sx:{p:{xs:2,sm:3}},children:[h.general&&e.jsx(d,{sx:{mb:2,p:1,bgcolor:"error.light",color:"error.contrastText",borderRadius:1},children:h.general}),e.jsxs(g,{container:!0,spacing:2,children:[e.jsx(g,{item:!0,xs:12,md:6,children:e.jsx(ee,{fullWidth:!0,label:"State Name",name:"stateName",value:n.stateName,onChange:N,error:!!h.stateName,helperText:h.stateName})}),e.jsx(g,{item:!0,xs:12,md:6,children:e.jsx(ee,{fullWidth:!0,label:"State Code",name:"stateCode",value:n.stateCode,onChange:N,error:!!h.stateCode,helperText:h.stateCode,placeholder:"e.g., CA, NY, TX",inputProps:{style:{textTransform:"uppercase"}}})}),e.jsx(g,{item:!0,xs:12,children:e.jsxs(Te,{fullWidth:!0,error:!!h.countryId,children:[e.jsx(ze,{children:"Country"}),e.jsxs(Fe,{name:"countryId",value:n.countryId,onChange:N,label:"Country",children:[e.jsx(te,{value:"",children:e.jsx("em",{children:"Select a country"})}),y.map(a=>e.jsx(te,{value:a.countryId,children:a.countryName},a.countryId))]}),h.countryId&&e.jsx(d,{sx:{color:"error.main",fontSize:"0.75rem",mt:.5},children:h.countryId})]})}),e.jsx(g,{item:!0,xs:12,children:e.jsx(Pe,{control:e.jsx(We,{checked:n.isActive,onChange:N,name:"isActive",color:"primary"}),label:"Active Status"})})]}),e.jsxs(Be,{children:[e.jsx(B,{type:"submit",variant:"contained",style:{backgroundColor:"#00afb5",color:"white"},children:A?"Update":"Add"}),e.jsx(B,{onClick:P,style:{color:"#00afb5"},children:"Cancel"})]})]})]})]})};export{ht as default};
